{"version":3,"sources":["webpack:///webpack/bootstrap 5b05477ef4a27d1d3ed3","webpack:///./index.js","webpack:///external \"babel-polyfill\"","webpack:///external \"path\"","webpack:///./src/database/helpers.js","webpack:///external \"moment\"","webpack:///./src/cli/index.js","webpack:///external \"commander\"","webpack:///./src/cli/init.js","webpack:///external \"child_process\"","webpack:///external \"prompt\"","webpack:///external \"chalk\"","webpack:///external \"lodash\"","webpack:///external \"fs\"","webpack:///./src/util.js","webpack:///external \"module\"","webpack:///./src/stats.js","webpack:///external \"os\"","webpack:///external \"crypto\"","webpack:///external \"universal-analytics\"","webpack:///external \"node-machine-id\"","webpack:///./src/cli/start.js","webpack:///./src/cli/create.js","webpack:///./src/cli/install.js","webpack:///./src/modules.js","webpack:///external \"bluebird\"","webpack:///external \"axios\"","webpack:///./src/configurator.js","webpack:///external \"js-yaml\"","webpack:///./src/cli/uninstall.js","webpack:///./src/cli/migrate.js","webpack:///./src/cli/migrations ^\\.\\/.*$","webpack:///./src/cli/migrations/0.1.js","webpack:///external \"knex\"","webpack:///./src/database/kvs.js","webpack:///./src/cli/list.js","webpack:///./src/botpress.js","webpack:///external \"source-map-support/register\"","webpack:///external \"cluster\"","webpack:///external \"dotenv\"","webpack:///./extensions/lite/ServiceLocator.js","webpack:///./extensions/lite/services.js","webpack:///./src/bus.js","webpack:///external \"eventemitter2\"","webpack:///./src/middlewares.js","webpack:///external \"mware\"","webpack:///./src/licensing.js","webpack:///./src/listeners.js","webpack:///./extensions/lite/license/index.js","webpack:///./src/logger.js","webpack:///external \"winston\"","webpack:///./src/security/index.js","webpack:///external \"jsonwebtoken\"","webpack:///./extensions/lite/authentication/index.js","webpack:///./src/notifications.js","webpack:///external \"uuid\"","webpack:///./src/hear.js","webpack:///./src/fallback.js","webpack:///./src/database/index.js","webpack:///./src/database/tables.js","webpack:///./extensions/lite/database/index.js","webpack:///./src/database/users.js","webpack:///./src/database/tags.js","webpack:///./src/about.js","webpack:///./src/umm/index.js","webpack:///external \"util\"","webpack:///./src/umm/engine.js","webpack:///external \"mustache\"","webpack:///external \"ms\"","webpack:///./src/umm/proactive.js","webpack:///./src/users.js","webpack:///./src/conversations.js","webpack:///./package.json","webpack:///./extensions/lite/emails/index.js","webpack:///./extensions/lite/mediator/index.js","webpack:///./src/server/index.js","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///./src/server/socket.js","webpack:///external \"socket.io\"","webpack:///external \"socketio-jwt\"","webpack:///./src/server/static.js","webpack:///./src/server/api.js","webpack:///external \"body-parser\"","webpack:///./src/server/anonymous.js","webpack:///./extensions/lite/api/index.js","webpack:///./extensions/lite/api/accounts.js","webpack:///./src/server/secured.js"],"names":["global","_babelPolyfill","require","path","DatabaseHelpers","CLI","Botpress","module","exports","isLite","knex","client","config","dateParse","raw","exp","dateFormat","iso","date","toDate","toISOString","columnOrDateFormat","lite","colOrDate","sql","createTableIfNotExists","tableName","cb","schema","hasTable","then","exists","format","now","isBefore","d1","d2","isAfter","isBetween","d3","isSameDay","hourOfDay","bool","true","false","parse","value","json","set","obj","JSON","stringify","get","command","description","option","action","alias","version","process","argv","args","length","help","introductionText","waitingText","nextStepText","bold","assertDoesntExist","file","existsSync","print","exit","getTemplate","template","templatePath","join","__dirname","templateContent","readFileSync","generateTemplate","filename","variables","compiled","destination","replace","writeFileSync","generate","result","mkdirSync","install","npmCmd","stdout","on","data","write","toString","stderr","code","program","dirName","undefined","chdir","track","each","currentDirectoryName","basename","resolve","properties","name","white","pattern","message","required","default","author","yes","delimiter","start","err","IS_DEV","env","NODE_ENV","NPM_CMD","test","platform","mapping","info","warn","yellow","arguments","error","red","success","green","level","matched","splice","console","log","black","bgWhite","resolveFromDir","fromDir","moduleId","fromFile","_resolveFilename","id","paths","_nodeModulePaths","resolveModuleRootPath","entryPath","current","dirname","lookup","resolveProjectFile","projectLocation","throwIfNotExist","packagePath","Error","getBotpressVersion","botpressPackagePath","botpressJson","isDeveloping","botfile","visitor","queued","catch","hash","createHash","update","arch","hostname","type","digest","mid","strictCidFormat","forEach","a","category","label","optOutStats","push","event","trackException","projectPath","options","eval","stack","bot","MODULE_NAME_CONVENTION_BEGINS","MODULE_NAME_REGEX","RegExp","doneText","documentation","directory","prefixModuleNameWithBotpress","moduleDirectory","modules","modulesManager","MODULES_URL","FETCH_TIMEOUT","logger","dataLocation","kvs","apply","fetchAllModules","timeout","loadModules","moduleDefinitions","botpress","loadedCount","loadedModules","loader","mod","entry","handlers","configuration","init","scanModules","botPackage","deps","dependencies","merge","devDependencies","reduce","key","root","modulePackage","homepage","settings","getRandomCommunityHero","method","modulesCachePath","listAllCommunityModules","sample","username","github","avatar","contributions","hero","contributors","login","html_url","avatar_url","mapModuleList","installed","listInstalledModules","map","stars","stargazers_count","forks","forks_count","docLink","latest","keywords","fullName","full_name","updated","updated_at","issues","open_issues_count","icon","package","menuIcon","includes","license","title","featured","popular","official","diff","props","newModules","debug","Date","resolveModuleNames","names","TypeError","prefix","substr","runSpawn","reject","installModules","cwd","uninstallModules","uninstall","prodDeps","keys","filter","dep","listInstalled","_scan","_load","validations","validation","defaultValues","amendOption","validTypes","amendOptions","mapValues","validateSet","validateSave","object","objKeys","requiredKeys","validateName","overwriteFromDefaultValues","overwriteFromEnvValues","_v","overwriteFromBotfileValues","config_name","overwriteFromConfigFileValues","configFilePath","fromCallback","safeLoadAll","callback","configFromFile","removeUnusedKeys","final","createConfig","saveAll","loadAll","all","fromVersion","files","sortBy","x","toApply","f","parseFloat","mapSeries","migration","finally","botfilePath","bot_path","dbLocation","dataDir","migrate_database_schema","migrate_botfile","updateUsers","connection","useNullAsDefault","table","string","created_on","rows","bootstrap","DELETE_TABLES","dropTableIfExists","has","dropTable","before","indexOf","after","getSetCallback","betweenGetAndSetCallback","where","limit","row","at","setValue","isNil","original","newObj","Object","assign","modified_on","insert","primary","text","timestamp","RESTART_EXIT_CODE","getDataLocation","isAbsolute","mkdirIfNeeded","stats","interval","inverval","setInterval","envPath","envConfig","k","ENV_OVERLOAD","isFirstRun","modulesConfigDir","db","sqlite","location","postgres","security","securityConfig","events","notifications","notification","about","licensing","middlewares","hear","hearMiddleware","middleware","fallbackMiddleware","emails","emailConfig","mediator","convo","umm","users","register","incomingMiddleware","bp","_loadedModules","server","emit","values","ready","port","middlewareAutoLoading","load","projectEntry","call","reason","p","isMaster","fork","worker","isWorker","_start","setTimeout","initPromise","isFulfilled","resolveInit","_services","throwIfNotFound","getService","registerService","fn","EventBus","wildcard","maxListeners","createMiddleware","middlewareName","_use","_error","use","dispatch","isPlainObject","conformity","conformsTo","run","_promise","middlewaresFilePath","incoming","outgoing","customizations","noopChain","readCustomizations","writeCustomizations","setCustomizations","order","enabled","resetCustomizations","handler","some","m","list","orderBy","customization","licenseMiddleware","sendToMiddleware","mw","sendIncoming","sendOutgoing","getCustomizations","licensesPath","getLicenses","packageJsonPath","agplContent","botpressContent","agpl","licensedUnder","toLowerCase","changeLicense","licensePath","licenseFileName","licenseContent","pkg","next","response","userId","user","sendText","to","responseTo","guard","getLicensing","licenses","currentLicense","find","getStatus","getFeatures","matches","conditions","pairs","toPairs","every","comparrer","eventValue","isFunction","isRegExp","isString","captured","tail","exec","isEqual","licensed","status","logConfig","Logger","transports","Console","prettyPrint","colorize","enableFileTransport","logFile","add","File","maxsize","maxSize","archiveToFile","disableFileLogs","authentication","tokenExpiry","password","ip","attempt","canAttempt","authenticate","loginUser","getSecret","secret","token","sign","expiresIn","decoded","verify","verifyUser","verified","_authentication","secretPath","createNewSecret","randomBytes","adminPassword","BOTPRESS_ADMIN_PASSWORD","attempts","lastCleanTimestamp","maxAttempts","resetAfter","email","first_name","last_name","roles","resetSecret","createJsonStore","filePath","initData","save","bindEvents","loadNotifs","saveNotifs","markReadIf","cond","notif","read","notifConfig","notificationsFile","sendNotif","url","sound","callingFile","getOriginatingModule","callingModuleRoot","menuText","v4","maxLength","pop","unshift","logMessage","send","origPrepareStackTrace","prepareStackTrace","_","shift","getFileName","chain","condition","fallbackHandler","initializeCoreDatabase","createKnex","_knex","host","database","ssl","pool","afterCreate","conn","getDb","saveUser","gender","timezone","locale","picture_url","userRow","query","select","from","kvs_instance","createKvs","_kvs","getKvs","kvsGet","instance","kvsSet","concat","table_factories","enu","integer","unique","getBotInformation","packageJson","fs","promisifyAll","statAsync","storagePath","isDirectory","readdirAsync","contents","extname","readFileAsync","getDocument","incomingEvent","blocName","additionalData","split","fileName","markdown","fullContext","originalEvent","isObject","blocs","context","outputPlatform","bloc","doSendBloc","sendBloc","processors","templates","getStoragePath","registerConnector","processOutgoing","verbose","throwIfNoPlatform","currentPlatform","getTemplates","ummPath","single","folder","saveDocument","content","writeFileAsync","__internal","delay","wait","processIncoming","reply","proactiveMethods","ParsingError","instructionIndex","internalMessage","captureStackTrace","mapBlocs","rawBlocs","mapBloc","premapInstruction","instruction","index","instructions","detectedPlatforms","isArray","evaluate","val","isArrayLike","isEmpty","if","unless","i","platforms","trim","mapKeys","__","trimmed","mapInstruction","messages","ret","parseInt","typing","omit","processor","msg","mustached","render","rawBloc","getUser","inspect","forgedEvent","forged","sendToUser","tag","toUpper","hasTag","tagged_on","del","untag","getTag","tags","v","getTags","getCreationDate","fromId","fromDate","whereNot","Promise","count","INTERVAL_MSGS","formatMessage","initialEvent","formatBloc","isBloc","isBlocCall","startsWith","validateHandlers","Thread","queue","archive","waiting","_last","blocData","enqueue","last","match","defaultHandler","Conversation","messageTypes","clockSpeed","_threads","currentThread","defaultThread","createThread","_get","_set","_cache","intervalBetweenMessages","_timeoutHandle","_timeoutInterval","_useTimeout","_clock","tick","_clockSpeed","_processing","_sendLock","_outgoing","endWhenDone","sendNext","setImmediate","clearInterval","clearTimeout","thread","getCurrentThread","peek","restart","emitAsync","dequeue","say","stop","resetTimeout","repeat","teardown","convos","belongsToConvo","initial","c","validateEvent","create","activate","destroy","app","api","serveApi","socket","serveSocket","staticStuff","serveStatic","createServer","listen","io","admin","of","guest","handshake","authorize","visitorId","socketId","onAny","__socketId","__room","serveModule","req","res","appName","contentType","serveCustomTheme","static","headers","accept","sendFile","shortName","iconRequestPath","iconPath","liteDir","liteViews","readdirSync","b","endsWith","settingsKey","webBundle","bundlePath","params","subview","sendStatus","customTheme","themeLocation","routersConditions","routers","maybeSendRequireLogin","authorization","end","_authenticationMiddleware","installRouter","installProtector","installMaybeUse","maybeUse","urlencoded","extended","maybeApply","getRouter","router","Router","secure","operation","ressource","wrap","authorizeApi","authorized","post","put","delete","originalUrl","body","apis","anonymous","installAnonymous","secured","installSecured","logsSecret","noInterface","plugins","getContributor","unlink","until","fields","results","archivePath","download"],"mappings":"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AiB;;AACxBA,eAAM6X,QAAN;AACD;AAHgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAKjBC,cAAS,EAAT;AACD;;AAED,UAAO,EAAE7pB,YAAF,EAASkqB,cAAT,EAAiBtS,UAAjB,EAAuBwS,gBAAvB,EAAP;AACD,EA7ED,C;;;;;;AC3aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAE;AACF;AACA;AACA,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAmB,eAAe;AAClC,GAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;;;;;;;;AClJAnxB,QAAOC,OAAP,GAAiB,YAAM,CAAE,CAAzB,C;;;;;;;;ACAAD,QAAOC,OAAP,GAAiB;AAAA,UAAO;AACtBkF,cAAS,mBAAM,CAAE,CADK;AAEtBoM,gBAAW,qBAAM,CAAE;AAFG,IAAP;AAAA,EAAjB,C;;;;;;;;ACAA;;;;AACA;;;;AAEA;;;;AACA;;;;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","file":"node.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/slvn/Desktop/botpress\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 5b05477ef4a27d1d3ed3","if (!global._babelPolyfill) {\n  require('babel-polyfill')\n}\n\nvar path = require('path')\n\nvar DatabaseHelpers = require('./src/database/helpers.js')\n\nvar CLI = () => require('./src/cli')\nvar Botpress = () => require('./src/botpress.js')\n\nmodule.exports = { Botpress, DatabaseHelpers, CLI }\n\n\n\n// WEBPACK FOOTER //\n// ./index.js","module.exports = require(\"babel-polyfill\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"babel-polyfill\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","/*\n  The goal of these helpers is to generate SQL queries\n  that are valid for both SQLite and Postgres\n*/\n\nimport moment from 'moment'\n\nconst isLite = knex => {\n  return knex.client.config.client === 'sqlite3'\n}\n\nmodule.exports = knex => {\n\n  const dateParse = exp => {\n    return isLite(knex)\n    ? knex.raw(`strftime('%Y-%m-%dT%H:%M:%fZ', ${exp})`)\n    : knex.raw(exp)\n  }\n\n  const dateFormat = date => {\n    const iso = moment(date).toDate().toISOString()\n    return dateParse(`'${iso}'`)\n  }\n\n  const columnOrDateFormat = colOrDate => {\n    const lite = isLite(knex)\n\n    if (colOrDate.sql) {\n      return colOrDate.sql\n    }\n\n    if (typeof colOrDate === 'string') {\n      return lite ? dateParse(colOrDate) : `\"${colOrDate}\"`\n    }\n\n    return dateFormat(colOrDate)\n  }\n\n  return {\n    isLite: () => isLite(knex),\n\n    // knex's createTableIfNotExists doesn't work with postgres\n    // https://github.com/tgriesser/knex/issues/1303\n    createTableIfNotExists: (tableName, cb) => {\n      return knex.schema.hasTable(tableName)\n      .then(exists => {\n        if (exists) { return }\n        return knex.schema.createTableIfNotExists(tableName, cb)\n      })\n    },\n\n    date: {\n      format: dateFormat,\n\n      now: () => isLite(knex) ? knex.raw(\"strftime('%Y-%m-%dT%H:%M:%fZ', 'now')\") : knex.raw('now()'),\n\n      isBefore: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(d1 + ' < ' + d2)\n      },\n\n      isAfter: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(d1 + ' > ' + d2)\n      },\n\n      isBetween: (d1, d2, d3) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n        d3 = columnOrDateFormat(d3)\n\n        return knex.raw(`${d1} BETWEEN ${d2} AND ${d3}`)\n      },\n\n      isSameDay: (d1, d2) => {\n        d1 = columnOrDateFormat(d1)\n        d2 = columnOrDateFormat(d2)\n\n        return knex.raw(`date(${d1}) = date(${d2})`)\n      },\n\n      hourOfDay: date => {\n        date = columnOrDateFormat(date)\n        return isLite(knex)\n          ? knex.raw(`strftime('%H', ${date})`)\n          : knex.raw(`to_char(${date}, 'HH24')`)\n      }\n    },\n\n    bool: {\n\n      true: () => isLite(knex) ? 1 : true,\n      false: () => isLite(knex) ? 0 : false,\n      parse: value => isLite(knex) ? !!value : value\n\n    },\n\n    json: {\n      set: obj => {\n        return isLite(knex) ? obj && JSON.stringify(obj) : obj\n      },\n      get: obj => {\n        return isLite(knex) ? obj && JSON.parse(obj) : obj\n      }\n    }\n\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/helpers.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 5\n// module chunks = 0","import program from 'commander'\n\nimport init from './init'\nimport start from './start'\nimport create from './create'\nimport install from './install'\nimport uninstall from './uninstall'\nimport migrate from './migrate'\nimport list from './list'\n\nimport { getBotpressVersion } from '../util'\n\nprogram\n  .command('init')\n  .description('Create a new bot in current directory')\n  .option('-y, --yes', 'Say yes to every prompt and use default values')\n  .action(init)\n\nprogram\n  .command('start [path]')\n  .alias('s')\n  .description('Starts running a bot')\n  .action(start)\n\nprogram\n  .command('install <module> [modules...]')\n  .alias('i')\n  .description('Add modules to the current bot')\n  .action(install)\n\nprogram\n  .command('uninstall <module> [modules...]')\n  .alias('u')\n  .description('Remove modules from the current bot')\n  .action(uninstall)\n\nprogram\n  .command('list')\n  .alias('ls')\n  .description('List installed modules')\n  .action(list)\n\nprogram\n  .command('create')\n  .alias('c')\n  .description('Create a new module for development or distribution')\n  .action(create)\n\nprogram\n  .command('migrate <fromVersion>')\n  .description('Migrates the current bot from version X')\n  .action(migrate)\n\nprogram\n  .version(getBotpressVersion())\n  .description('Easily create, manage and extend chatbots.')\n  .parse(process.argv)\n\nif (!program.args.length) {\n  program.help()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/index.js","module.exports = require(\"commander\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"commander\"\n// module id = 7\n// module chunks = 0","import { spawn } from 'child_process'\nimport prompt from 'prompt'\nimport chalk from 'chalk'\nimport path from 'path'\nimport _ from 'lodash'\nimport fs from 'fs'\nimport util from '../util'\nimport stats from '../stats'\n\nconst introductionText = \"\\nHey there, thanks for using botpress!\" +\n  \"\\nWe'll walk you through the creation of your new bot.\" +\n  \"\\nFor more information or help, please visit http://github.com/botpress/botpress\" + \"\\n---------------\"\n\nconst waitingText = 'please wait, we are installing everything for you...'\nconst nextStepText = 'now run ' + chalk.bold('`bp start`') + ' in your terminal'\n\nconst assertDoesntExist = (file) => {\n  if (fs.existsSync(file)) {\n    util.print('error', 'package.json or botfile.js are already in repository, ' +\n      'remove them before running this command again.')\n    process.exit(1)\n  }\n}\n\nconst getTemplate = (template) => {\n  const templatePath = path.join(__dirname, 'cli/templates/init', template)\n  const templateContent = fs.readFileSync(templatePath)\n  return _.template(templateContent)\n}\n\nconst generateTemplate = (filename, variables = {}) => {\n  const template = getTemplate(filename)\n  const compiled = template(variables)\n  const destination = path.join(filename.replace(/_\\._/, '.'))\n  fs.writeFileSync(destination, compiled)\n}\n\nconst generate = (result) => {\n  generateTemplate('package.json', result)\n  generateTemplate('LICENSE')\n  generateTemplate('botfile.js')\n  generateTemplate('index.js')\n  generateTemplate('content.yml')\n  generateTemplate('_._gitignore')\n  generateTemplate('_._welcome')\n  generateTemplate('theme.scss')\n\n  fs.mkdirSync('data')\n  fs.writeFileSync('data/bot.log', '')\n  fs.writeFileSync('data/notification.json', '[]')\n\n  fs.mkdirSync('modules_config')\n\n  util.print(waitingText)\n  const install = spawn(util.npmCmd, ['install'])\n\n  install.stdout.on('data', (data) => {\n    process.stdout.write(data.toString())\n  })\n\n  install.stderr.on('data', (data) => {\n    process.stdout.write(data.toString())\n  })\n\n  install.on('close', (code) => {\n    if (code > 0) {\n      util.print('error', 'an error occured during installation')\n    } else {\n      util.print('success', 'installation has completed successfully')\n      util.print(nextStepText)\n    }\n  })\n}\n\nmodule.exports = function(program) {\n  var dirName = process.argv[3]\n  if (dirName != undefined) {\n    if (!fs.existsSync(dirName)) {\n      fs.mkdirSync(dirName)\n      process.chdir(dirName)\n    } else {\n      util.print('error', dirName + \" directory already exists\")\n      return\n    }\n  }\n  stats({}).track('cli', 'bot', 'init')\n\n  util.print(introductionText)\n\n  _.each(['package.json', 'botfile.js', 'index.js'], assertDoesntExist)\n\n  const currentDirectoryName = path.basename(path.resolve('./'))\n\n  var schema = {\n    properties: {\n      name: {\n        description: chalk.white('name:'),\n        pattern: /^[a-z0-9][a-z0-9-_\\.]+$/,\n        message: 'name must be only lowercase letters, ' +\n          'digits, dashes, underscores and dots.',\n        required: true,\n        default: currentDirectoryName\n      },\n      description: {\n        required: false,\n        description: chalk.white('description:')\n      },\n      author: {\n        required: false,\n        description: chalk.white('author:')\n      },\n      version: {\n        required: false,\n        description: chalk.white('version:'),\n        default: '0.0.1'\n      },\n    }\n  }\n\n  if (program.yes) {\n    generate({\n      name: currentDirectoryName,\n      description: '',\n      author: '',\n      version: '0.0.1'\n    })\n  } else {\n    prompt.message = ''\n    prompt.delimiter = ''\n    prompt.start()\n    prompt.get(schema, function(err, result) {\n      generate(result)\n    })\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/cli/init.js","module.exports = require(\"child_process\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"child_process\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"prompt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"prompt\"\n// module id = 10\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 12\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 13\n// module chunks = 0","import chalk from 'chalk'\nimport path from 'path'\nimport Module from 'module'\nimport fs from 'fs'\n\nconst IS_DEV = process.env.NODE_ENV !== 'production'\n\nconst NPM_CMD = /^win/.test(process.platform) ? 'npm.cmd' : 'npm'\n\nconst print = function(...args) {\n  const mapping = {\n    info: chalk.white,\n    warn: function() { return chalk.yellow('WARN', ...arguments) },\n    error: function() { return chalk.red('ERR', ...arguments) },\n    success: function() { return chalk.green('OK', ...arguments) }\n  }\n\n  let level = mapping[args[0]]\n  const matched = !!level\n\n  if (!matched) {\n    level = mapping.info\n  } else {\n    args.splice(0, 1)\n  }\n\n  console.log(chalk.black.bgWhite('[botpress]'), '\\t', level(...args))\n}\n\nconst resolveFromDir = function (fromDir, moduleId) {\n  fromDir = path.resolve(fromDir)\n  const fromFile = path.join(fromDir, 'noop.js')\n  try {\n    return Module._resolveFilename(moduleId, {\n      id: fromFile,\n      filename: fromFile,\n      paths: Module._nodeModulePaths(fromDir)\n    })\n  } catch (err) {\n    return null\n  }\n}\n\nconst resolveModuleRootPath = function(entryPath) {\n  let current = path.dirname(entryPath)\n  while (current !== '/') {\n    const lookup = path.join(current, 'package.json')\n    if (fs.existsSync(lookup)) {\n      return current\n    }\n    current = path.resolve(path.join(current, '..'))\n  }\n  return null\n}\n\nconst resolveProjectFile = (file, projectLocation, throwIfNotExist) => {\n  const packagePath = path.resolve(projectLocation || './', file)\n\n  if (!fs.existsSync(packagePath)) {\n    if (throwIfNotExist) {\n      throw new Error('Could not find bot\\'s package.json file')\n    }\n    return null\n  }\n\n  return packagePath\n}\n\nconst getBotpressVersion = () => {\n  const botpressPackagePath = path.join(__dirname, '../package.json')\n  const botpressJson = JSON.parse(fs.readFileSync(botpressPackagePath))\n  return botpressJson.version\n}\n\nmodule.exports = {\n  print,\n  resolveFromDir,\n  isDeveloping: IS_DEV,\n  resolveModuleRootPath,\n  resolveProjectFile,\n  npmCmd: NPM_CMD,\n  getBotpressVersion\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/util.js","module.exports = require(\"module\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"module\"\n// module id = 15\n// module chunks = 0","import os from 'os'\nimport crypto from 'crypto'\nimport ua from 'universal-analytics'\nimport { machineId } from 'node-machine-id'\n\nmodule.exports = (botfile) => {\n\n  let visitor = null\n  let queued = []\n\n  machineId()\n  .catch(() => {\n    const hash = crypto.createHash('sha256')\n    hash.update(os.arch() + os.hostname() + os.platform() + os.type())\n    return hash.digest('hex')\n  })\n  .then(mid => {\n    visitor = ua('UA-90044826-1', mid, { strictCidFormat: false })\n    queued.forEach(a => a())\n    queued = []\n  })\n\n  const track = (category, action, label = null, value = null) => {\n    if (!!botfile.optOutStats) {\n      return // Don't track if bot explicitly opted out from stats collection\n    }\n\n    if (!visitor) {\n      queued.push(() => track(category, action, label, value))\n      return\n    }\n\n    visitor.event(category, action, label, value, () => { /* ignore errors */ })\n  }\n\n  const trackException = message => {\n    if (!!botfile.optOutStats) {\n      return // Don't track if bot explicitly opted out from stats collection\n    }\n\n    if (!visitor) {\n      queued.push(() => trackException(message))\n      return\n    }\n\n    visitor.event(message, () => { /* ignore errors */ })\n  }\n\n  return { track, trackException }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/stats.js","module.exports = require(\"os\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"os\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"universal-analytics\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"universal-analytics\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"node-machine-id\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-machine-id\"\n// module id = 20\n// module chunks = 0","import path from 'path'\nimport fs from 'fs'\nimport util from '../util'\nimport chalk from 'chalk'\n\n/**\n * Entry point of botpress\n *\n * It will do the following things:\n *\n * 1. Find botpress instance creator in `node_modules` folder in current project.\n * 2. Find the `botfile.js` which will be injected into the creator to create the instance.\n * 3. Start the botpress instance.\n */\nmodule.exports = function(projectPath, options) {\n  let Botpress = null\n\n  if (!projectPath || typeof(projectPath) !== 'string') {\n    projectPath = '.'\n  }\n\n  projectPath = path.resolve(projectPath)\n\n  try {\n    Botpress = eval('require')(path.join(projectPath, 'node_modules', 'botpress')).Botpress()\n  } catch (err) {\n    util.print('error', err.message)\n    util.print('error', err.stack)\n    util.print('error', '(fatal) Could not load the local version of botpress')\n    util.print('Hint: 1) have you used `botpress init` to create a new bot the proper way?')\n    util.print('Hint: 2) Do you have read and write permissions on the current directory?')\n    util.print('-------------')\n    util.print('If none of the above works, this might be a bug in botpress. ' +\n      'Please contact the Botpress Team on gitter and provide the printed error above.')\n    process.exit(1)\n  }\n\n  const botfile = path.join(projectPath, 'botfile.js')\n  if (!fs.existsSync(botfile)) {\n    util.print('error', `(fatal) No ${chalk.bold('botfile.js')} file found at: ` + botfile)\n    process.exit(1)\n  }\n\n  const bot = new Botpress({ botfile })\n  bot.start()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/start.js","import { spawn } from 'child_process'\nimport prompt from 'prompt'\nimport chalk from 'chalk'\nimport path from 'path'\nimport fs from 'fs'\nimport _ from 'lodash'\nimport util from '../util'\nimport stats from '../stats'\n\nconst MODULE_NAME_CONVENTION_BEGINS = 'botpress-'\nconst MODULE_NAME_REGEX = new RegExp(/^botpress-.*/g)\n\nconst introductionText = \"This program will bootstrap a new Botpress module\"\nconst doneText = \"You're all set! The module is boostrapped and ready to be developed.\"\nconst documentation = \"Tip: when coding your bot, use the command `npm run watch` to recompile\" +\n  \" your module automatically. Also, we strongly recommend that you install your module using \" +\n  \"`npm link ../path/to/botpress-module` so that your bot always points to the most recent version.\"\n\nconst getTemplate = (template) => {\n  const templatePath = path.join(__dirname, 'cli/templates/create' , template)\n  const templateContent = fs.readFileSync(templatePath)\n  return _.template(templateContent)\n}\n\nconst generateTemplate = (directory, filename, variables = {}) => {\n  const template = getTemplate(filename)\n  const compiled = template(variables)\n  const destination = path.join(directory, filename.replace(/_\\._/, '.'))\n  fs.writeFileSync(destination, compiled)\n}\n\nconst prefixModuleNameWithBotpress = name => {\n\n  if (!MODULE_NAME_REGEX.test(name)) {\n    util.print('warn','the name of your module needs to begin by \"botpress-\"')\n    util.print('warn','we renamed your module to '+ chalk.bold(MODULE_NAME_CONVENTION_BEGINS + name))\n    name = MODULE_NAME_CONVENTION_BEGINS + name\n  }\n\n  return name\n}\n\n\nmodule.exports = function() {\n  const moduleDirectory = path.resolve('.')\n  const dirname = path.basename(moduleDirectory)\n\n  stats({}).track('cli', 'modules', 'create')\n\n  util.print(introductionText)\n\n  var schema = {\n    properties: {\n      name: {\n        description: chalk.white('module name:'),\n        pattern: /^[a-z0-9][a-z0-9-_\\.]+$/,\n        message: 'name must be only lowercase letters, ' +\n          'digits, dashes, underscores and dots.',\n        required: true,\n        default: dirname\n      },\n      description: {\n        required: false,\n        description: chalk.white('description:')\n      },\n      author: {\n        required: false,\n        description: chalk.white('author:')\n      },\n      version: {\n        required: false,\n        description: chalk.white('version:'),\n        default: '1.0.0'\n      }\n    }\n  }\n\n  prompt.message = ''\n  prompt.delimiter = ''\n\n  prompt.start()\n\n  prompt.get(schema, function (err, result) {\n    result.name = prefixModuleNameWithBotpress(result.name)\n    \n    \n    if (dirname !== result.name) {\n      util.print('warn', 'We usually recommend that the name of the module directory'\n        + ` (${dirname}) be the same as the module name (${result.name})`)\n    }\n\n    if (fs.existsSync(path.join(moduleDirectory, 'package.json'))) {\n      util.print('error', \"Expected module directory to be empty / uninitialized\")\n      process.exit(1)\n    } else {\n      generateTemplate(moduleDirectory, 'package.json', result)\n      generateTemplate(moduleDirectory, 'LICENSE')\n      generateTemplate(moduleDirectory, 'webpack.js')\n      generateTemplate(moduleDirectory, '_._gitignore')\n      generateTemplate(moduleDirectory, '_._npmignore')\n\n      fs.mkdirSync(moduleDirectory + '/src')\n      generateTemplate(moduleDirectory, 'src/index.js')\n\n      fs.mkdirSync(moduleDirectory + '/src/views')\n      generateTemplate(moduleDirectory, 'src/views/index.jsx')\n      generateTemplate(moduleDirectory, 'src/views/style.scss')\n\n      util.print('Installing dependencies, please wait...')\n\n      const install = spawn(util.npmCmd, ['install'])\n\n      install.stdout.on('data', (data) => {\n        process.stdout.write(data.toString())\n      })\n\n      install.stderr.on('data', (data) => {\n        process.stdout.write(data.toString())\n      })\n\n      install.on('close', (code) => {\n        if (code > 0) {\n          util.print('error', 'An error occured during the dependencies installation of your module')\n        } else {\n          util.print('success', 'Module dependencies installed')\n          util.print(doneText)\n          util.print(documentation)\n        }\n      })\n    }\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/create.js","import util from '../util'\n\nimport createModules from '../modules'\n\nimport stats from '../stats'\n\nconst waitingText = 'please wait, we are trying to install your new modules...'\n\nmodule.exports = function(module, modules) {\n  stats({}).track('cli', 'modules', 'install')\n  util.print('info', waitingText)\n  let modulesManager = createModules(null, './', null)\n  modulesManager.install(module, ...modules)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/install.js","import { spawn } from 'child_process'\nimport path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\nimport _ from 'lodash'\nimport moment from 'moment'\nimport axios from 'axios'\nimport { createConfig } from './configurator'\n\nimport {\n  print,\n  isDeveloping,\n  npmCmd,\n  resolveModuleRootPath,\n  resolveFromDir,\n  resolveProjectFile\n} from './util'\n\nconst MODULES_URL = 'https://s3.amazonaws.com/botpress-io/all-modules.json'\nconst FETCH_TIMEOUT = 5000\n\nmodule.exports = (logger, projectLocation, dataLocation, kvs) => {\n\n  const log = (level, ...args) => {\n    if (logger && logger[level]) {\n      logger[level].apply(this, args)\n    } else {\n      print.apply(this, [level, ...args])\n    }\n  }\n\n  const fetchAllModules = () => {\n    return axios.get(MODULES_URL, { timeout: FETCH_TIMEOUT })\n    .then(({ data }) => data)\n    .catch(() => logger.error('Could not fetch modules'))\n  }\n\n  const loadModules = (moduleDefinitions, botpress) => {\n    let loadedCount = 0\n    const loadedModules = {}\n\n    moduleDefinitions.forEach(mod => {\n      const loader = eval('require')(mod.entry)\n\n      if (typeof loader !== 'object') {\n        return logger.warn(`Ignoring module ${mod.name}. Invalid entry point signature.`)\n      }\n\n      mod.handlers = loader\n\n      try {\n        mod.configuration = createConfig({\n          kvs: kvs,\n          name: mod.name,\n          botfile: botpress.botfile,\n          projectLocation,\n          options: loader.config || {}\n        })\n      } catch (err) {\n        logger.error(`Invalid module configuration in module ${mod.name}:`, err)\n      }\n\n      try {\n        loader.init && loader.init(botpress, mod.configuration)\n      } catch (err) {\n        logger.warn('Error during module initialization: ', err)\n      }\n\n      loadedModules[mod.name] = mod\n      logger.info(`Loaded ${mod.name}, version ${mod.version}`)\n      loadedCount++\n    })\n\n    if (loadedCount > 0) {\n      logger.info(`Loaded ${loadedCount} modules`)\n    }\n\n    return loadedModules\n  }\n\n  const scanModules = () => {\n    const packagePath = path.join(projectLocation, 'package.json')\n\n    if (!fs.existsSync(packagePath)) {\n      return logger.warn('No package.json found at project root, ' +\n        'which means botpress can\\'t load any module for the bot.')\n    }\n\n    const botPackage = eval('require')(packagePath)\n\n    let deps = botPackage.dependencies || {}\n    if (isDeveloping) {\n      deps = _.merge(deps, botPackage.devDependencies || {})\n    }\n\n    return _.reduce(deps, (result, value, key) => {\n      if (!/^botpress-/i.test(key)) {\n        return result\n      }\n      const entry = resolveFromDir(projectLocation, key)\n      if (!entry) {\n        return result\n      }\n      const root = resolveModuleRootPath(entry)\n      if (!root) {\n        return result\n      }\n\n      const modulePackage = eval('require')(path.join(root, 'package.json'))\n      if (!modulePackage.botpress) {\n        return result\n      }\n\n      return result.push({\n        name: key,\n        root: root,\n        homepage: modulePackage.homepage,\n        settings: modulePackage.botpress,\n        version: modulePackage.version,\n        entry: entry\n      }) && result\n    }, [])\n  }\n\n  const getRandomCommunityHero = Promise.method(() => {\n    const modulesCachePath = path.join(dataLocation, './modules-cache.json')\n\n    return listAllCommunityModules()\n    .then(() => {\n      const { modules } = JSON.parse(fs.readFileSync(modulesCachePath))\n\n      const module = _.sample(modules)\n\n      if (!module) {\n        return {\n          username: 'danyfs',\n          github: 'https://github.com/danyfs',\n          avatar: 'https://avatars1.githubusercontent.com/u/5629987?v=3',\n          contributions: 'many',\n          module: 'botpress'\n        }\n      }\n\n      const hero = _.sample(module.contributors)\n\n      return {\n        username: hero.login,\n        github: hero.html_url,\n        avatar: hero.avatar_url,\n        contributions: hero.contributions,\n        module: module.name\n      }\n    })\n  })\n\n  const mapModuleList = (modules) => {\n    const installed = listInstalledModules()\n    return modules.map(mod => ({\n      name: mod.name,\n      stars: mod.github.stargazers_count,\n      forks: mod.github.forks_count,\n      docLink: mod.homepage,\n      version: mod['dist-tags'].latest,\n      keywords: mod.keywords,\n      fullName: mod.github.full_name,\n      updated: mod.github.updated_at,\n      issues: mod.github.open_issues_count,\n      icon: mod.package.botpress.menuIcon,\n      description: mod.description,\n      installed: _.includes(installed, mod.name),\n      license: mod.license,\n      author: !mod.author.name ? mod.author : mod.author.name,\n      title: mod.title,\n      category: mod.category,\n      featured: mod.featured,\n      popular: mod.popular,\n      official: mod.official\n    }))\n  }\n\n  const listAllCommunityModules = Promise.method(() => {\n\n    if (!fs) {\n      return [] // TODO Fetch & return\n    }\n\n    const modulesCachePath = path.join(dataLocation, './modules-cache.json')\n    if (!fs.existsSync(modulesCachePath)) {\n      fs.writeFileSync(modulesCachePath, JSON.stringify({\n        modules: [],\n        updated: null\n      }))\n    }\n\n    const { modules, updated } = JSON.parse(fs.readFileSync(modulesCachePath))\n\n    if (updated && moment().diff(moment(updated), 'minutes') <= 30) {\n      return mapModuleList(modules)\n    }\n\n    return Promise.props({\n      newModules: fetchAllModules()\n    })\n    .then(({ newModules }) => {\n\n      if (!newModules || !newModules.length) {\n        if (modules.length > 0) {\n          logger.debug('Fetched invalid modules. Report this to the Botpress Team.')\n          return mapModuleList(modules)\n        } else {\n          newModules = newModules || []\n        }\n      }\n\n      fs.writeFileSync(modulesCachePath, JSON.stringify({\n        modules: newModules,\n        updated: new Date()\n      }))\n\n      return mapModuleList(newModules)\n    })\n  })\n\n  const resolveModuleNames = (names) => {\n    return names.map(name => {\n      if (!name || typeof(name) !== 'string') {\n        throw new TypeError('Expected module name to be a string')\n      }\n\n      let basename = path.basename(name)\n      let prefix = ''\n\n      if (basename !== name) {\n        prefix = name.substr(0, name.length - basename.length - 1)\n      }\n\n      if (basename.replace(/botpress-?/i, '').length === 0) {\n        throw new Error(`Invalid module name: ${basename}`)\n      }\n\n      if (!/^botpress-/i.test(basename)) {\n        basename = `botpress-${basename}`\n      }\n\n      return prefix + basename\n    })\n  }\n\n  const runSpawn = (command) => {\n    return new Promise((resolve, reject) => {\n      command.stdout.on('data', (data) => {\n        log('info', data.toString())\n      })\n\n      command.stderr.on('data', (data) => {\n        log('error', data.toString())\n      })\n\n      command.on('close', (code) => {\n        if (code > 0) {\n          reject()\n        } else {\n          resolve()\n        }\n      })\n    })\n  }\n\n  const installModules = Promise.method((...names) => {\n    let modules = resolveModuleNames(names)\n\n    const install = spawn(npmCmd, ['install', '--save', ...modules], {\n      cwd: projectLocation\n    })\n\n    log('info', 'Installing modules: ' + modules.join(', '))\n\n    return runSpawn(install)\n    .then(() => log('success', 'Modules successfully installed'))\n    .catch(err => {\n      log('error', 'An error occured during modules installation.')\n      throw err\n    })\n  })\n\n  const uninstallModules = Promise.method((...names) => {\n    let modules = resolveModuleNames(names)\n    const uninstall = spawn(npmCmd, ['uninstall', '--save', ...modules], {\n      cwd: projectLocation\n    })\n\n    log('info', `Uninstalling modules: ${modules.join(', ')}`)\n\n    return runSpawn(uninstall)\n    .then(() => log('success', 'Modules successfully removed'))\n    .catch(err => {\n      log('error', 'An error occured during modules removal.')\n      throw err\n    })\n  })\n\n\n  const listInstalledModules = () => {\n    const packagePath = resolveProjectFile('package.json', projectLocation, true)\n    const { dependencies } = JSON.parse(fs.readFileSync(packagePath))\n    const prodDeps = _.keys(dependencies)\n\n    return _.filter(prodDeps, dep => /botpress-.+/i.test(dep))\n  }\n\n  return {\n    listAllCommunityModules,\n    getRandomCommunityHero,\n    install: installModules,\n    uninstall: uninstallModules,\n    listInstalled: listInstalledModules,\n    _scan: scanModules,\n    _load: loadModules\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 26\n// module chunks = 0","import _ from 'lodash'\nimport fs from 'fs'\nimport path from 'path'\nimport yaml from 'js-yaml'\nimport Promise from 'bluebird'\n\nconst validations = {\n  'any': (value, validation) => validation(value),\n  'string': (value, validation) => typeof(value) === 'string' && validation(value),\n  'choice': (value, validation) => _.includes(validation, value),\n  'bool': (value, validation) => (value === true || value === false) && validation(value)\n}\n\nconst defaultValues = {\n  'any': null,\n  'string': '',\n  'bool': false\n}\n\nconst amendOption = (option, name) => {\n\n  const validTypes = _.keys(validations)\n  if (!option.type || !_.includes(validTypes, option.type)) {\n    throw new Error(`Invalid type (${option.type || ''}) for config key (${name})`)\n  }\n\n  const validation = option.validation || (() => true)\n\n  if (typeof(option.default) !== 'undefined' && !validations[option.type](option.default, validation)) {\n    throw new Error(`Invalid default value (${option.default}) for (${name})`)\n  }\n\n  if (!option.default && !_.includes(_.keys(defaultValues), option.type)) {\n    throw new Error(`Default value is mandatory for type ${option.type} (${name})`)\n  }\n\n  return {\n    type: option.type,\n    required: option.required || false,\n    env: option.env || null,\n    default: option.default || defaultValues[option.type],\n    validation: validation\n  }\n}\n\nconst amendOptions = options => {\n  return _.mapValues(options, amendOption)\n}\n\nconst validateSet = (options, name, value) => {\n\n  // if name is not in options, throw\n  if (!_.includes(_.keys(options), name)) {\n    throw new Error(`Unrecognized configuration key: ${name}`)\n  }\n\n  if (!validations[options[name].type](value, options[name].validation)) {\n    throw new Error(`Invalid value for key: ${name}`)\n  }\n}\n\nconst validateSave = (options, object) => {\n  const objKeys = _.keys(object)\n  const requiredKeys = _.filter(_.keys(options), key => options[key].required)\n\n  _.each(requiredKeys, required => {\n    if (!_.includes(objKeys, required)) {\n      throw new Error(`Missing required configuration: '${required}'`)\n    }\n  })\n\n  _.each(objKeys, name => {\n    validateSet(options, name, object[name])\n  })\n}\n\nconst validateName = name => {\n  if (!name || !/^[A-Z0-9._-]+$/i.test(name)) {\n    throw new Error(`Invalid configuration name: ${name}. The name must only contain letters, _ and -`)\n  }\n}\n\nconst overwriteFromDefaultValues = (options, object) => {\n  _.each(_.keys(options), name => {\n    if (typeof object[name] === 'undefined') {\n      object[name] = options[name].default\n    }\n  })\n\n  return object\n}\n\nconst overwriteFromEnvValues = (options, object) => {\n  return _.mapValues(object, (_v, name) => {\n    if (options[name] && options[name].env && process.env[options[name].env]) {\n      return process.env[options[name].env]\n    }\n\n    return _v\n  })\n}\n\nconst overwriteFromBotfileValues = (config_name, options, botfile, object) => {\n  return _.mapValues(object, (_v, name) => {\n    if (botfile \n      && botfile.config \n      && botfile.config[config_name] \n      && typeof botfile.config[config_name][name] !== 'undefined') {\n      return botfile.config[config_name][name]\n    }\n\n    return _v\n  })\n}\n\nconst overwriteFromConfigFileValues = async (config_name, options, projectLocation, object) => {\n  if (!projectLocation) {\n    return object\n  }\n\n  const configFilePath = path.resolve(projectLocation, `${config_name}.config.yml`)\n\n  if (!fs.existsSync(configFilePath)) {\n    return object\n  }\n\n  const configFromFile = await Promise.fromCallback(callback => {\n    yaml.safeLoadAll(fs.readFileSync(configFilePath), value => callback(null, value))\n  })\n\n  return _.mapValues(object, (_v, name) => {\n    if (typeof configFromFile[name] !== 'undefined') {\n      return configFromFile[name]\n    }\n    return _v\n  })\n}\n\nconst removeUnusedKeys = (options, object) => {\n  const final = {}\n\n  _.each(_.keys(options), name => {\n    if (typeof object[name] !== 'undefined') {\n      final[name] = object[name]\n    }\n  })\n\n  return final\n}\n\nconst createConfig = ({ kvs, name, botfile = {}, options = {}, projectLocation = null }) => {\n\n  if (!kvs || !kvs.get || !kvs.set) {\n    throw new Error('A valid \\'kvs\\' is mandatory to createConfig')\n  }\n\n  validateName(name)\n  options = amendOptions(options)\n\n  const saveAll = obj => {\n    validateSave(options, obj)\n    return kvs.set('__config', obj, name)\n  }\n\n  const loadAll = () => {\n    return kvs.get('__config', name)\n    .then(all => overwriteFromDefaultValues(options, all || {}))\n    .then(all => overwriteFromBotfileValues(name, options, botfile, all))\n    .then(all => overwriteFromConfigFileValues(name, options, projectLocation, all))\n    .then(all => overwriteFromEnvValues(options, all))\n    .then(all => removeUnusedKeys(options, all))\n  }\n\n  const get = name => {\n    return kvs.get('__config', name + '.' + name)\n    .then(value => overwriteFromDefaultValues(options, { [name]: value }))\n    .then(all => overwriteFromBotfileValues(name, options, botfile, all))\n    .then(all => overwriteFromConfigFileValues(name, options, projectLocation, all))\n    .then(all => overwriteFromEnvValues(options, all))\n    .then(obj => obj[name])\n  }\n\n  const set = (name, value) => {\n    validateSet(options, name, value)\n    return kvs.set('__config', value, name + '.' + name)\n  }\n  \n  return { saveAll, loadAll, get, set, options }\n}\n\nmodule.exports = { createConfig }\n\n\n\n// WEBPACK FOOTER //\n// ./src/configurator.js","module.exports = require(\"js-yaml\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-yaml\"\n// module id = 28\n// module chunks = 0","import util from '../util'\n\nimport createModules from '../modules'\n\nimport stats from '../stats'\n\nconst waitingText = 'please wait, we are trying to uninstall the modules...'\n\nmodule.exports = function(module, modules) {\n  stats({}).track('cli', 'modules', 'install')\n  util.print('info', waitingText)\n  let modulesManager = createModules(null, './', null)\n  modulesManager.uninstall(module, ...modules)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/uninstall.js","import util from '../util'\nimport stats from '../stats'\nimport fs from 'fs'\nimport path from 'path'\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nmodule.exports = function(fromVersion) {\n  stats({}).track('cli', 'migration', fromVersion)\n\n  if (!fs.existsSync('./botfile.js')) {\n    throw new Error('You must be inside a bot directory to run a migration')\n  }\n\n  let files = _.sortBy(require.context('./migrations/').keys(), x => x)\n\n  const toApply = _.filter(files, f => {\n    if (!/.js$/i.test(f)) {\n      return false\n    }\n\n    return parseFloat(fromVersion) < parseFloat(f.replace(/\\.js/i, ''))\n  })\n\n  return Promise.mapSeries(toApply, file => {\n    const migration = require('./migrations/' + file)\n    return migration(path.resolve('.'))\n    .then(() => {\n      util.print('success', `Migration ${file.replace('.js', '')} applied successfully`)\n    })\n  })\n  .finally(() => {\n    util.print('success', 'Migration completed.')\n    process.exit(0)\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/migrate.js","var map = {\n\t\"./0.1\": 32,\n\t\"./0.1.js\": 32\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\treturn map[req] || (function() { throw new Error(\"Cannot find module '\" + req + \"'.\") }());\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 31;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/cli/migrations ^\\.\\/.*$\n// module id = 31\n// module chunks = 0","import Knex from 'knex'\nimport path from 'path'\nimport fs from 'fs'\n\nimport kvs from '../../database/kvs'\nimport util from '../../util'\n\nmodule.exports = bot_path => {\n  const botfilePath = path.join(bot_path, 'botfile.js')\n  const botfile = eval('require')(botfilePath)\n  const dbLocation = path.resolve(path.join(bot_path, botfile.dataDir, 'db.sqlite'))\n\n  return migrate_database_schema(dbLocation)\n  .then(() => migrate_botfile(botfilePath))\n}\n\n\nfunction migrate_database_schema(dbLocation) {\n\n  const updateUsers = `strftime('%Y-%m-%dT%H:%M:%fZ', created_on/1000, 'unixepoch')`\n\n  const knex = Knex({\n    client: 'sqlite3',\n    connection: { filename: dbLocation },\n    useNullAsDefault: true\n  })\n\n  return knex.schema.table('users', function (table) {\n    table.string('picture_url')\n    table.string('first_name')\n    table.string('last_name')\n  })\n  .then(() => knex('users').update({ created_on: knex.raw(updateUsers) }))\n  .then(rows => {\n    util.print('info', 'Updated ' + rows + ' users')\n    util.print('warn', 'Users table was migrated to new schema but existing '\n      + 'users will miss the following fields: `picture_url`, `first_name`, '\n      + '`last_name`. They have been left to `null`.')\n  })\n  .catch(() => {\n    util.print('warn', 'Did not migrate table `users` as schema was already up to date')\n  })\n  .then(() => kvs(knex).bootstrap())\n  .catch(() => {\n    util.print('warn', 'Did not create table `kvs` as schema was already up to date')\n  })\n  .then(() => {\n\n    if (!process.env.DELETE_TABLES) {\n      util.print('warn', \"This migration must delete the tables of \"\n        + \"the following modules: `botpress-scheduler`, `botpress-analytics`, \"\n        + \"`botpress-hitl` and `botpress-subscription`.\")\n\n      util.print('warn', \"This step has been skipped because you didn't provide \"\n        + \"the DELETE_TABLES=true environement variable.\")\n\n      util.print('warn', \"Please backup your data if necessary then re-run with DELETE_TABLES=true\")\n      return false\n    }\n\n    return dropTableIfExists(knex, 'analytics_interactions')\n    .then(() => dropTableIfExists(knex, 'analytics_runs'))\n    .then(() => dropTableIfExists(knex, 'broadcast_outbox'))\n    .then(() => dropTableIfExists(knex, 'broadcast_schedules'))\n    .then(() => dropTableIfExists(knex, 'hitl_messages'))\n    .then(() => dropTableIfExists(knex, 'hitl_sessions'))\n    .then(() => dropTableIfExists(knex, 'subscription_users'))\n    .then(() => dropTableIfExists(knex, 'subscriptions'))\n    .then(() => dropTableIfExists(knex, 'scheduler_schedules'))\n    .then(() => dropTableIfExists(knex, 'scheduler_tasks'))\n    .then(() => util.print('info', 'Dropped module tables'))\n  })\n}\n\nfunction dropTableIfExists(knex, tableName) {\n  return knex.schema.hasTable(tableName)\n  .then(has => {\n    if (has) {\n      return knex.schema.dropTable(tableName)\n    }\n  })\n}\n\nfunction migrate_botfile(botfilePath) {\n  const before = fs.readFileSync(botfilePath).toString()\n\n  if (before.indexOf('postgres:') >= 0) {\n    util.print('warn', 'Did not migrate botfile as it seemed like `postgres`'\n      + ' was already present. Please migrate manually if this is a mistake.')\n    return false\n  }\n\n  const after = before.replace(/module\\.exports.*?=.*?{/i, `module.exports = {\n\n  /**\n  * Postgres configuration\n  */\n  postgres: {\n    enabled: process.env.DATABASE === 'postgres',\n    host: process.env.PG_HOST || '127.0.0.1',\n    port: process.env.PG_PORT || 5432,\n    user: process.env.PG_USER || '',\n    password: process.env.PG_PASSWORD || '',\n    database: process.env.PG_DB || ''\n  },`)\n\n  fs.writeFileSync(botfilePath, after)\n\n  util.print('info', 'Updated botfile')\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/migrations/0.1.js","module.exports = require(\"knex\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"knex\"\n// module id = 33\n// module chunks = 0","import Promise from 'bluebird'\nimport _ from 'lodash'\n\nimport helpers from './helpers'\n\n/*\n  Possible options:\n    - betweenGetAndSetCallback: will be called between the get and the set\n    and wait for promise to resolve\n    - tableName: overrides the KVS table's name\n*/\nmodule.exports = (knex, options = {}) => {\n  const getSetCallback = options.betweenGetAndSetCallback || (() => Promise.resolve())\n  const tableName = options.tableName || 'kvs'\n\n  const get = (key, path) => {\n    return knex(tableName).where({ key }).limit(1).then().get(0).then(row => {\n      if (!row) {\n        return null\n      }\n\n      const obj = JSON.parse(row.value)\n      if (!path) {\n        return obj\n      }\n\n      return _.at(obj, [path])[0]\n    })\n  }\n\n  const set = (key, value, path) => {\n    const now = helpers(knex).date.now()\n\n    const setValue = obj => {\n      if (path) {\n        _.set(obj, path, value)\n        return obj\n      } else {\n        return value\n      }\n    }\n\n    return get(key)\n    .then(original => {\n      return getSetCallback()\n      .then(() => {\n        if (!_.isNil(original)) {\n          const newObj = setValue(Object.assign({}, original))\n          return knex(tableName).where({ key }).update({\n            value: JSON.stringify(newObj),\n            modified_on: now\n          }).then()\n        } else {\n          const obj = setValue({})\n          return knex(tableName).insert({\n            key: key,\n            value: JSON.stringify(obj),\n            modified_on: now\n          }).then()\n        }\n      })\n    })\n  }\n\n  const bootstrap = () => {\n    return helpers(knex).createTableIfNotExists(tableName, function(table) {\n      table.string('key').primary()\n      table.text('value')\n      table.timestamp('modified_on')\n    })\n  }\n\n  return { get, set, bootstrap }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/kvs.js","import { print } from '../util'\n\nimport createModules from '../modules'\n\nmodule.exports = function() {\n  let modulesManager = createModules(null, './', null)\n  let modules = modulesManager.listInstalled()\n\n  if (!modules || modules.length === 0) {\n    print('info', \"There are no module installed.\")\n    print('------------------')\n    print('info', \"To install modules, use `botpress install <module-name>`\")\n    print('info', \"You can discover modules in the Modules section of your bot UI\" +\n      \". You can also search npm with the botpress keyword.\")\n  } else {\n    print('info', \"There are \" + modules.length + \" modules installed:\")\n    modules.forEach(mod => print('>> ' + mod))\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/cli/list.js","import 'source-map-support/register'\n\nimport chalk from 'chalk'\nimport path from 'path'\nimport fs from 'fs'\nimport _ from 'lodash'\nimport cluster from 'cluster'\nimport dotenv from 'dotenv'\n\nimport ServiceLocator from '+/ServiceLocator'\nimport EventBus from './bus'\n\nimport createMiddlewares from './middlewares'\nimport createLogger from './logger'\nimport createSecurity from './security'\nimport createNotifications from './notifications'\nimport createHearMiddleware from './hear'\nimport createFallbackMiddleware from './fallback'\nimport createDatabase from './database'\nimport createLicensing from './licensing'\nimport createAbout from './about'\nimport createModules from './modules'\nimport createUMM from './umm'\nimport createUsers from './users'\nimport createConversations from './conversations'\nimport stats from './stats'\nimport packageJson from '../package.json'\nimport createEmails from '+/emails'\nimport createMediator from '+/mediator'\n\nimport createServer from './server'\n\nimport { getBotpressVersion } from './util'\n\nimport {\n  isDeveloping,\n  print\n} from './util'\n\nconst RESTART_EXIT_CODE = 107\n\nconst getDataLocation = (dataDir, projectLocation) => (\n  dataDir && path.isAbsolute(dataDir)\n    ? path.resolve(dataDir)\n    : path.resolve(projectLocation, dataDir || 'data')\n)\n\nconst mkdirIfNeeded = (path, logger) => {\n  if (!fs.existsSync(path)) {\n    logger.info(`Creating data directory: ${path}`)\n\n    try {\n      fs.mkdirSync(path)\n    } catch (err) {\n      logger.error(`[FATAL] Error creating directory: ${err.message}`)\n      process.exit(1)\n    }\n  }\n}\n\n/**\n * Global context botpress\n*/\nclass botpress {\n  /**\n   * Create botpress\n   *\n   * @param {string} obj.botfile - the config path\n   */\n  constructor({ botfile }) {\n    this.version = getBotpressVersion()\n    /**\n     * The project location, which is the folder where botfile.js located\n     */\n    this.projectLocation = path.dirname(botfile)\n\n    /**\n     * The botfile config object\n     */\n    this.botfile = eval('require')(botfile)\n\n    this.stats = stats(this.botfile)\n\n    this.interval = null\n  }\n\n  /**\n   * Start the bot instance\n   *\n   * It will do the following initiation steps:\n   *\n   * 1. setup logger\n   * 2. resolve paths (dataLocation)\n   * 3. inject security functions\n   * 4. load modules\n   */\n  _start() {\n\n    this.stats.track('bot', 'started')\n\n    if (!this.interval) {\n      this.inverval = setInterval(() => {\n        this.stats.track('bot', 'running')\n      }, 30 * 1000)\n    }\n\n    // change the current working directory to botpress's installation path\n    // the bot's location is kept in this.projectLocation\n    process.chdir(path.join(__dirname, '../'))\n\n    const { projectLocation, botfile } = this\n\n    const envPath = path.resolve(projectLocation, '.env')\n    if (fs.existsSync(envPath)) {\n      const envConfig = dotenv.parse(fs.readFileSync(envPath))\n      for (var k in envConfig) {\n        if (_.isNil(process.env[k]) || process.env.ENV_OVERLOAD) {\n          process.env[k] = envConfig[k]\n        }\n      }\n    }\n\n    const isFirstRun = fs.existsSync(path.join(projectLocation, '.welcome'))\n    const dataLocation = getDataLocation(botfile.dataDir, projectLocation)\n    const modulesConfigDir = getDataLocation(botfile.modulesConfigDir, projectLocation)\n    const dbLocation = path.join(dataLocation, 'db.sqlite')\n    const version = packageJson.version\n\n    const logger = createLogger(dataLocation, botfile.log)\n    mkdirIfNeeded(dataLocation, logger)\n    mkdirIfNeeded(modulesConfigDir, logger)\n\n    logger.info(`Starting botpress version ${version}`)\n\n    const db = createDatabase({\n      sqlite: { location: dbLocation },\n      postgres: botfile.postgres\n    })\n\n    const security = createSecurity({\n      dataLocation,\n      securityConfig: botfile.login,\n      db\n    })\n\n    const modules = createModules(logger, projectLocation, dataLocation, db.kvs)\n\n    const moduleDefinitions = modules._scan()\n\n    const events = new EventBus()\n    const notifications = createNotifications(dataLocation, botfile.notification, moduleDefinitions, events, logger)\n    const about = createAbout(projectLocation)\n    const licensing = createLicensing({ logger, projectLocation, version, db, botfile })\n    const middlewares = createMiddlewares(this, dataLocation, projectLocation, logger)\n    const { hear, middleware: hearMiddleware } = createHearMiddleware()\n    const { middleware: fallbackMiddleware } = createFallbackMiddleware(this)\n    const emails = createEmails({ emailConfig: botfile.emails })\n    const mediator = createMediator(this)\n    const convo = createConversations({ logger, middleware: middlewares })\n    const umm = createUMM({ logger, middlewares, projectLocation, botfile, db })\n    const users = createUsers({ db })\n\n    middlewares.register(umm.incomingMiddleware)\n    middlewares.register(hearMiddleware)\n    middlewares.register(fallbackMiddleware)\n\n    _.assign(this, {\n      dataLocation,\n      isFirstRun,\n      version,\n      logger,\n      security, // login, authenticate, getSecret\n      events,\n      notifications,    // load, save, send\n      about,\n      middlewares,\n      hear,\n      licensing,\n      modules,\n      db,\n      emails,\n      mediator,\n      convo,\n      umm,\n      users\n    })\n\n    ServiceLocator.init({ bp: this })\n\n    const loadedModules = modules._load(moduleDefinitions, this)\n\n    this.stats.track('bot', 'modules', 'loaded', loadedModules.length)\n\n    _.assign(this, {\n      _loadedModules: loadedModules\n    })\n\n    mediator.install()\n\n    const server = createServer(this)\n    server.start()\n    .then(() => {\n      events.emit('ready')\n      for (let mod of _.values(loadedModules)) {\n        mod.handlers.ready && mod.handlers.ready(this, mod.configuration)\n      }\n\n      const { port } = botfile\n      logger.info(chalk.green.bold('Bot launched. Visit: http://localhost:' + port))\n    })\n\n    const middlewareAutoLoading = _.get(botfile, 'middleware.autoLoading')\n    if (!_.isNil(middlewareAutoLoading) && middlewareAutoLoading === false) {\n      logger.debug('Middleware Auto Loading was disabled. Call bp.middlewares.load() manually.')\n    } else {\n      middlewares.load()\n    }\n\n    const projectEntry = eval('require')(projectLocation)\n    if (typeof(projectEntry) === 'function') {\n      projectEntry.call(projectEntry, this)\n    } else {\n      logger.error('[FATAL] The bot entry point must be a function that takes an instance of bp')\n      process.exit(1)\n    }\n\n    process.on('uncaughtException', err => {\n      logger.error('[FATAL] An unhandled exception occured in your bot', err)\n      if (isDeveloping) {\n        logger.error(err.stack)\n      }\n\n      this.stats.trackException(err.message)\n      process.exit(1)\n    })\n\n    process.on('unhandledRejection', (reason, p) => {\n      logger.error('Unhandled Rejection in Promise: ', p, 'Reason:', reason)\n\n      this.stats.trackException(reason)\n      if (isDeveloping && reason && reason.stack) {\n        logger.error(reason.stack)\n      }\n    })\n  }\n\n  start() {\n    if (cluster.isMaster) {\n      cluster.fork()\n\n      cluster.on('exit', (worker, code /* , signal */) => {\n        if (code === RESTART_EXIT_CODE) {\n          cluster.fork()\n\n          this.stats.track('bot', 'restarted')\n          print('info', '*** restarted worker process ***')\n        } else {\n          process.exit(code)\n        }\n      })\n    }\n\n    if (cluster.isWorker) {\n      this._start()\n    }\n  }\n\n  restart(interval = 0) {\n    setTimeout(() => {\n      process.exit(RESTART_EXIT_CODE)\n    }, interval)\n  }\n}\n\nmodule.exports = botpress\n\n\n\n// WEBPACK FOOTER //\n// ./src/botpress.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 37\n// module chunks = 0","module.exports = require(\"cluster\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cluster\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"dotenv\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"dotenv\"\n// module id = 39\n// module chunks = 0","import Promise from 'bluebird'\nimport services from '+/services'\n\nconst _services = {}\nlet resolveInit = false\n\nlet initPromise = new Promise(resolve => {\n  resolveInit = resolve\n})\n\nasync function init(obj) {\n  if (!initPromise.isFulfilled()) {\n    resolveInit()\n    Object.assign(_services, await services(obj))\n  }\n}\n\nfunction registerService(name, fn) {\n  if (!!_services[name]) {\n    throw new Error(`Service '${name}' has already been set`)\n  }\n\n  _services[name] = fn\n}\n\nasync function getService(name, throwIfNotFound = true) {\n  await initPromise\n  .timeout(5000)\n  .catch(err => {\n    throw new Error('ServiceLocator was not initialized')\n  })\n  \n  if (throwIfNotFound && !_services[name]) {\n    throw new Error(`Service '${name}' not registered`)\n  }\n\n  return _services[name]\n}\n\nmodule.exports = { init, registerService, getService }\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/ServiceLocator.js","module.exports = async ({ bp }) => {}\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/services.js","import EventEmitter2 from 'eventemitter2'\n\nclass EventBus extends EventEmitter2 {\n  constructor() {\n    super({\n      wildcard: true,\n      maxListeners: 100\n    })\n  }\n}\n\nmodule.exports = EventBus\n\n\n\n// WEBPACK FOOTER //\n// ./src/bus.js","module.exports = require(\"eventemitter2\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"eventemitter2\"\n// module id = 43\n// module chunks = 0","import _ from 'lodash'\nimport mware from 'mware'\nimport path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\n\nimport licensing from './licensing'\n\nconst createMiddleware = function(bp, middlewareName) {\n  const _use = mware()\n  const _error = mware()\n\n  const use = function(middleware) {\n    if (typeof(middleware) !== 'function') {\n      throw new TypeError('Expected all middleware arguments to be functions')\n    }\n\n    if (middleware.length === 2) {\n      _use(middleware)\n    } else if (middleware.length === 3) {\n      _error(middleware)\n    }\n  }\n\n  const dispatch = function(event) {\n    if (!_.isPlainObject(event)) {\n      throw new TypeError('Expected all dispatch arguments to be plain event objects')\n    }\n\n    const conformity = {\n      type: function(value) { return typeof(value) === 'string' },\n      platform: function(value) { return typeof(value) === 'string' },\n      text: function(value) { return typeof(value) === 'string' },\n      raw: function() { return true }\n    }\n\n    if (!_.conformsTo(event, conformity)) {\n      throw new TypeError('Expected event to contain (type: string), ' +\n        '(platform: string), (text: string), (raw: any)')\n    }\n\n    // Provide botpress to the event handlers\n    event.bp = bp\n\n    _use.run(event, function(err) {\n      if (err) {\n        _error.run(err, event, () => {\n          bp.logger.error(`[BOTPRESS] Unhandled error in middleware (${middlewareName}). Error: ${err.message}`)\n        })\n      }\n    })\n\n    return event._promise || Promise.resolve()\n  }\n\n  return { use, dispatch }\n}\n\nmodule.exports = function(bp, dataLocation, projectLocation, logger) {\n  const middlewaresFilePath = path.join(dataLocation, 'middlewares.json')\n  let incoming, outgoing, middlewares, customizations\n\n  const noopChain = function() {\n    let message = 'Middleware called before middlewares have been loaded. This is a no-op.'\n     + ' Have you forgotten to call `bp.loadMiddlewares()` in your bot?'\n\n    if (arguments && typeof(arguments[0]) === 'object') {\n      message += '\\nCalled with: ' + JSON.stringify(arguments[0], null, 2)\n    }\n\n    logger.warn(message)\n  }\n\n  const readCustomizations = () => {\n    if (!fs.existsSync(middlewaresFilePath)) {\n      fs.writeFileSync(middlewaresFilePath, '{}')\n    }\n    return JSON.parse(fs.readFileSync(middlewaresFilePath))\n  }\n\n  const writeCustomizations = () => {\n    fs.writeFileSync(middlewaresFilePath, JSON.stringify(customizations))\n  }\n\n  const setCustomizations = middlewares => {\n    _.each(middlewares, (middleware => {\n      const { name, order, enabled } = middleware\n      customizations[name] = { order, enabled }\n    }))\n    writeCustomizations()\n  }\n\n  const resetCustomizations = () => {\n    customizations = {}\n    writeCustomizations()\n  }\n\n  const register = (middleware) => {\n    if (!middleware || !middleware.name) {\n      logger.error('A unique middleware name is mandatory')\n      return false\n    }\n\n    if (!middleware.handler) {\n      logger.error('A middleware handler is mandatory')\n      return false\n    }\n\n    if (!middleware.type || (middleware.type !== 'incoming' && middleware.type !== 'outgoing')) {\n      logger.error('A middleware type (incoming or outgoing) is required')\n      return false\n    }\n\n    middleware.order = middleware.order || 0\n    middleware.enabled = typeof middleware.enabled === 'undefined' ? true: !!middleware.enabled\n\n    if (_.some(middlewares, m => m.name === middleware.name)) {\n      logger.error('Another middleware with the same name has already been registered')\n      return false\n    }\n\n    middlewares.push(middleware)\n  }\n\n  const list = () => {\n    return _.orderBy(middlewares.map(middleware => {\n      const customization = customizations[middleware.name]\n      if (customization) {\n        return Object.assign({}, middleware, customization)\n      }\n      return middleware\n    }), 'order')\n  }\n\n  const load = () => {\n    incoming = createMiddleware(bp, 'incoming')\n    outgoing = createMiddleware(bp, 'outgoing')\n\n    const { middleware: licenseMiddleware } = bp.licensing\n    incoming.use(licenseMiddleware)\n\n    _.each(list(), (m => {\n      if (!m.enabled) {\n        return logger.debug('SKIPPING middleware:', m.name, ' [Reason=disabled]')\n      }\n\n      logger.debug('Loading middleware:', m.name)\n\n      if (m.type === 'incoming') {\n        incoming.use(m.handler)\n      } else {\n        outgoing.use(m.handler)\n      }\n    }))\n  }\n\n  const sendToMiddleware = type => event => {\n    let mw = type === 'incoming' ? incoming : outgoing\n    return mw.dispatch ? mw.dispatch(event) : mw(event)\n  }\n\n  const sendIncoming = sendToMiddleware('incoming')\n  const sendOutgoing = sendToMiddleware('outgoing')\n\n  incoming = outgoing = noopChain\n  middlewares = []\n  customizations = readCustomizations()\n\n  return {\n    load,\n    list,\n    register,\n    sendIncoming,\n    sendOutgoing,\n    getCustomizations: () => customizations,\n    setCustomizations,\n    resetCustomizations\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/middlewares.js","module.exports = require(\"mware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mware\"\n// module id = 45\n// module chunks = 0","import path from 'path'\nimport fs from 'fs'\nimport Promise from 'bluebird'\n\nimport _ from 'lodash'\n\nimport listeners from './listeners'\nimport { resolveProjectFile, isDeveloping } from './util'\nimport LicenseGuard from '+/license'\n\nmodule.exports = ({ logger, version, projectLocation, db, botfile }) => {\n\n  const licensesPath = path.join(__dirname, '../licenses')\n\n  const getLicenses = () => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const { license } = JSON.parse(fs.readFileSync(packageJsonPath))\n\n    const agplContent = fs.readFileSync(path.join(licensesPath, 'LICENSE_AGPL3')).toString()\n    const botpressContent = fs.readFileSync(path.join(licensesPath, 'LICENSE_BOTPRESS')).toString()\n\n    return {\n      agpl: {\n        name: 'AGPL-3.0',\n        licensedUnder: license === 'AGPL-3.0',\n        text: agplContent\n      },\n      botpress: {\n        name: 'Botpress',\n        licensedUnder: license.toLowerCase().indexOf('botpress') >= 0,\n        text: botpressContent\n      }\n    }\n  }\n\n  const changeLicense = Promise.method((license) => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n\n    const licensePath = resolveProjectFile('LICENSE', projectLocation, true)\n    const licenseFileName = (license === 'AGPL-3.0') ? 'LICENSE_AGPL3' : 'LICENSE_BOTPRESS'\n    const licenseContent = fs.readFileSync(path.join(licensesPath, licenseFileName))\n\n    const pkg = JSON.parse(fs.readFileSync(packageJsonPath))\n    pkg.license = license\n\n    fs.writeFileSync(licensePath, licenseContent)\n    fs.writeFileSync(packageJsonPath, JSON.stringify(pkg, null, 2))\n  })\n\n  const middleware = listeners.hear(/^BOT_LICENSE$/, (event, next) => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const { license, name, author } = JSON.parse(fs.readFileSync(packageJsonPath))\n    const bp = event.bp\n\n    const response = `Bot:  ${name}\nCreated by: ${author}\nLicense: ${license}\nBotpress: ${bp.version}`\n\n    const userId = event.user && event.user.id\n\n    if (bp[event.platform] && bp[event.platform].sendText) {\n      bp[event.platform].sendText(userId, response)\n    } else {\n      bp.middlewares.sendOutgoing({\n        platform: event.platform,\n        type: 'text',\n        text: response,\n        raw: {\n          to: userId,\n          message: response,\n          responseTo: event\n        }\n      })\n    }\n  })\n\n  const guard = LicenseGuard(logger, db, botfile)\n  guard.start()\n\n  return {\n    getLicensing: async () => {\n      const licenses = getLicenses()\n      let currentLicense = _.find(licenses, { licensedUnder: true })\n      currentLicense = currentLicense || licenses.botpress\n\n      return Object.assign(await guard.getStatus(), {\n        text: currentLicense.text\n      })\n    },\n    changeLicense,\n    middleware,\n    getFeatures: guard.getFeatures\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/licensing.js","import _ from 'lodash'\n\nconst matches = function(conditions, event) {\n  if (!_.isPlainObject(conditions)) {\n    conditions = { text: conditions }\n  }\n\n  const pairs = _.toPairs(conditions)\n  return _.every(pairs, ([key, comparrer]) => {\n    const eventValue = _.get(event, key, null)\n\n    if (_.isFunction(comparrer)) {\n      return comparrer(eventValue, event) === true\n    } else if (_.isRegExp(comparrer)) {\n      const matches = comparrer.test(eventValue)\n      \n      if (matches && _.isString(eventValue)) {\n        if (_.isNil(event.captured)) {\n          event.captured = []\n        }\n        \n        const a = _.tail(comparrer.exec(eventValue))\n        a.forEach(m => event.captured.push(m))\n      }\n\n      return matches\n    } else {\n      return _.isEqual(comparrer, eventValue)\n    }\n  })\n}\n\nconst hear = function(conditions, callback) {\n  return (event, next) => {\n    const result = matches(conditions, event)\n\n    if (result && _.isFunction(callback)) {\n      if (callback.length <= 1) {\n        if (_.isFunction(next)) { \n          next()\n        }\n        callback(event)\n      } else {\n        callback(event, next)\n      }\n    } else {\n      if (_.isFunction(next)) { \n        next()\n      }\n    }\n  }\n}\n\nmodule.exports = { hear, matches }\n\n\n\n// WEBPACK FOOTER //\n// ./src/listeners.js","module.exports = (logger, db, botfile) => ({\n  // There is no License Guard in the Open-Source / Free version\n  start: () => {},\n  getStatus: async () => {\n    return {\n      licensed: true,\n      name: 'Botpress Community',\n      text: null,\n      status: 'Active'\n    }\n  },\n  getFeatures: () => ({})\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/license/index.js","import winston from 'winston'\nimport path from 'path'\nimport Promise from 'bluebird'\nimport moment from 'moment'\n\nimport { isDeveloping } from './util'\n\nmodule.exports = (dataLocation, logConfig) => {\n  const logger = new winston.Logger({\n    level: isDeveloping ? 'debug' : 'info',\n    transports: [\n      new (winston.transports.Console)({\n        prettyPrint: true,\n        colorize: true,\n        timestamp: () => moment().format('HH:mm:ss')\n      })\n    ]\n  })\n\n  logger.enableFileTransport = () => {\n    const logFile = path.join(dataLocation, logConfig.file)\n    logger.add(winston.transports.File, {\n      filename: logFile,\n      maxsize: logConfig.maxSize\n    })\n  }\n\n  logger.archiveToFile = () => {\n    const logFile = path.join(dataLocation, logConfig.file)\n\n    return Promise.resolve(logFile)\n  }\n\n  if (!logConfig.disableFileLogs) {\n    logger.enableFileTransport()\n  }\n\n  return logger\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/logger.js","module.exports = require(\"winston\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"winston\"\n// module id = 50\n// module chunks = 0","import jwt from 'jsonwebtoken'\nimport _ from 'lodash'\n\nimport Authentication from '+/authentication'\n\n/**\n * Security helper for botpress\n *\n * Constructor of following functions\n *\n *   - login(user, password, ip)\n *   - authenticate(token)\n *   - getSecret()\n *\n * It will find or create a secret.key in `dataLocation`, then setup the adminPassword for user login.\n *\n */\n\nmodule.exports = ({ dataLocation, securityConfig, db }) => {\n\n  const authentication = Authentication({ dataLocation, securityConfig, db })\n  const { tokenExpiry } = securityConfig\n\n  // login function that returns a {success, reason, token} object\n  // accounts for number of bad attempts\n  const login = async function(user, password, ip = 'all') {\n    const canAttempt = await authentication.attempt(ip)\n    if (!canAttempt) {\n      return { success: false, reason: 'Too many login attempts. Try again later.' }\n    }\n\n    const loginUser = await authentication.authenticate(user, password, ip)\n\n    if (loginUser) {\n      const secret = await authentication.getSecret()\n\n      return {\n        success: true,\n        token: jwt.sign({ user: loginUser }, secret, { expiresIn: tokenExpiry })\n      }\n    } else {\n      return {\n        success: false,\n        reason: 'Bad username / password'\n      }\n    }\n  }\n\n  /**\n   * @param {string} token\n   * @return {boolean} whether the token is valid\n   */\n  const authenticate = async function(token) {\n    try {\n      const secret = await authentication.getSecret()\n      const decoded = jwt.verify(token, secret)\n      const verified = authentication.verifyUser\n        ? await authentication.verifyUser(decoded)\n        : true\n      return verified && decoded.user\n    } catch (err) {\n      return false\n    }\n  }\n\n  return {\n    login,\n    authenticate,\n    getSecret: authentication.getSecret,\n    _authentication: authentication\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/security/index.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 52\n// module chunks = 0","import fs from 'fs'\nimport path from 'path'\nimport crypto from 'crypto'\nimport Promise from 'bluebird'\n\nmodule.exports = ({ dataLocation, securityConfig }) => {\n\n  // reading secret from data or creating new secret\n  let secret = ''\n  const secretPath = path.join(dataLocation, 'secret.key')\n\n  const createNewSecret = () => {\n    secret = crypto.randomBytes(256).toString()\n    fs.writeFileSync(secretPath, secret)\n    return secret\n  }\n\n  if (fs.existsSync(secretPath)) {\n    secret = fs.readFileSync(secretPath)\n  }\n\n  if (!secret || secret.length < 15) {\n    secret = createNewSecret()\n  }\n\n  const adminPassword = process.env.BOTPRESS_ADMIN_PASSWORD || securityConfig.password\n\n  // a per-ip cache that logs login attempts\n  let attempts = {}\n  let lastCleanTimestamp = new Date()\n  const { maxAttempts, resetAfter } = securityConfig\n\n  function attempt(ip) {\n    // reset the cache if time elapsed\n    if (new Date() - lastCleanTimestamp >= resetAfter) {\n      attempts = {}\n      lastCleanTimestamp = new Date()\n    }\n\n    return (attempts[ip] || 0) < maxAttempts\n  }\n\n  function authenticate(user, password, ip) {\n    if (typeof(user) === 'string' && user.toLowerCase() === 'admin' &&\n      typeof(password) === 'string' && password === adminPassword) {\n      attempts[ip] = 0\n      return {\n        id: 0,\n        email: 'admin@botpress.io',\n        first_name: 'Admin',\n        last_name: 'Admin',\n        avatar_url: null,\n        roles: ['admin']\n      }\n    } else {\n      attempts[ip] = (attempts[ip] || 0) + 1\n      return null\n    }\n  }\n\n  function getSecret() {\n    return secret\n  }\n\n  function resetSecret() {\n    return createNewSecret()\n  }\n\n  // Public API\n  return {\n    attempt: Promise.method(attempt),\n    authenticate: Promise.method(authenticate),\n    getSecret: Promise.method(getSecret),\n    resetSecret: Promise.method(resetSecret)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/authentication/index.js","import _ from 'lodash'\nimport fs from 'fs'\nimport path from 'path'\nimport uuid from 'uuid'\n\nimport { resolveModuleRootPath } from './util'\n\n// TODO this can be an util\nconst createJsonStore = (filePath, initData) => ({\n  load: () => {\n    if (fs.existsSync(filePath)) {\n      return JSON.parse(fs.readFileSync(filePath))\n    }\n\n    return initData\n  },\n\n  save: data => {\n    fs.writeFileSync(filePath, JSON.stringify(data))\n  }\n})\n\nconst bindEvents = (loadNotifs, saveNotifs, events) => {\n  events.on('notifications.getAll', () => {\n    events.emit('notifications.all', loadNotifs())\n  })\n\n  const markReadIf = cond => {\n    const notifications = loadNotifs()\n    .map(notif => {\n      if (cond(notif)) {\n        notif.read = true\n      }\n      return notif\n    })\n\n    saveNotifs(notifications)\n    events.emit('notifications.all', notifications)\n  }\n\n  events.on('notifications.read', (id) => {\n    markReadIf(notif => notif.id === id)\n  })\n\n  events.on('notifications.allRead', () => {\n    markReadIf(() => true)\n  })\n\n  events.on('notifications.trashAll', () => {\n    saveNotifs([])\n    events.emit('notifications.all', [])\n  })\n}\n\nexport default (dataLocation, notifConfig, modules, events, logger) => {\n  const notificationsFile = path.join(dataLocation, notifConfig.file)\n\n  const {\n    load: loadNotifs,\n    save: saveNotifs,\n  } = createJsonStore(notificationsFile, [])\n\n  bindEvents(loadNotifs, saveNotifs, events)\n\n  const sendNotif = ({ message, url, level, sound }) => {\n\n    if (!message || typeof(message) !== 'string') {\n      throw new Error('\\'message\\' is mandatory and should be a string')\n    }\n\n    if (\n      !level || typeof(level) !== 'string' ||\n      !_.includes(['info', 'error', 'success'], level.toLowerCase())\n    ) {\n      level = 'info'\n    } else {\n      level = level.toLowerCase()\n    }\n\n    const callingFile = getOriginatingModule()\n    const callingModuleRoot = callingFile && resolveModuleRootPath(callingFile)\n\n    const module = _.find(modules, (mod) => {\n      return mod.root === callingModuleRoot\n    })\n\n    let options = {\n      // TODO should probably go in settings as defaults\n      moduleId: 'botpress',\n      icon: 'view_module',\n      name: 'botpress',\n      url: url || '/'\n    }\n\n    if (module) {\n      // because the bot itself can send notifications\n      options = {\n        moduleId: module.name,\n        icon: module.settings.menuIcon,\n        name: module.settings.menuText,\n        url: url\n      }\n\n      if (!url || typeof(url) !== 'string') {\n        options.url = `/modules/${module.name}`\n      }\n    }\n\n    const notification = {\n      id: uuid.v4(),\n      message: message,\n      level: level,\n      moduleId: options.moduleId,\n      icon: options.icon,\n      name: options.name,\n      url: options.url,\n      date: new Date(),\n      sound: sound || false,\n      read: false\n    }\n\n    let notifications = loadNotifs()\n    if (notifications.length >= notifConfig.maxLength) {\n      notifications.pop()\n    }\n\n    notifications.unshift(notification)\n    saveNotifs(notifications)\n\n    events.emit('notifications.new', notification)\n\n    const logMessage = `[notification::${notification.moduleId}] ${notification.message}`\n    if (logger) {\n      (logger[level] || logger.info)(logMessage)\n    }\n  }\n\n  return {\n    load: loadNotifs,\n    save: saveNotifs,\n    send: sendNotif,\n  }\n}\n\nfunction getOriginatingModule() {\n  // TODO Explain hack\n  var origPrepareStackTrace = Error.prepareStackTrace\n  Error.prepareStackTrace = function (_, stack) {\n    return stack\n  }\n  var err = new Error()\n  var stack = err.stack\n  Error.prepareStackTrace = origPrepareStackTrace\n  stack.shift()\n\n  return stack[1].getFileName()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/notifications.js","module.exports = require(\"uuid\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"uuid\"\n// module id = 55\n// module chunks = 0","import mware from 'mware'\nimport listeners from './listeners'\n\nmodule.exports = () => {\n\n  const chain = mware()\n  const handler = (event, next) => {\n    chain.run(event, function() {\n      next.apply(this, arguments)\n    })\n  }\n\n  const middleware = {\n    name: 'hear',\n    type: 'incoming',\n    order: 20,\n    module: 'botpress',\n    description: 'The built-in hear convenience middleware',\n    handler: handler\n  }\n\n  const hear = (condition, callback) => {\n    chain(listeners.hear(condition, callback))\n  }\n\n  return { hear, middleware }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/hear.js","import _ from 'lodash'\nimport listeners from './listeners'\n\nmodule.exports = bp => {\n\n  const middleware = {\n    name: 'fallback',\n    type: 'incoming',\n    order: 200,\n    module: 'botpress',\n    description: 'The built-in fallback handler. You may override this by implementing bp.fallbackHandler',\n    handler: (event, next) => {\n      if (_.isFunction(bp.fallbackHandler)) {\n        bp.fallbackHandler(event, next)\n      }\n    }\n  }\n\n  return { middleware }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/fallback.js","import Promise from 'bluebird'\nimport moment from 'moment'\n\nimport tables from './tables'\nimport kvs from './kvs'\n\nconst initializeCoreDatabase = knex => {\n  if (!knex) {\n    throw new Error('You must initialize the database before')\n  }\n\n  return Promise.mapSeries(tables, fn => fn(knex))\n}\n\nconst createKnex = async ({ sqlite, postgres }) => {\n  let _knex = null\n\n  if (postgres.enabled) {\n\n    // If we're passing in a postgres connection string, \n    // use that instead of the other params\n    if (postgres.connection) {\n      _knex = require('knex')({\n        client: 'pg',\n        connection: postgres.connection,\n        useNullAsDefault: true\n      })\n    } else {\n      _knex = require('knex')({\n        client: 'pg',\n        connection: {\n          host: postgres.host,\n          port: postgres.port,\n          user: postgres.user,\n          password: postgres.password,\n          database: postgres.database,\n          ssl: postgres.ssl\n        },\n        useNullAsDefault: true\n      })\n    }\n    \n  } else {\n    _knex = require('knex')({\n      client: 'sqlite3',\n      connection: { filename: sqlite.location },\n      useNullAsDefault: true,\n      pool: { \n        afterCreate: (conn, cb) => {\n          conn.run('PRAGMA foreign_keys = ON', cb)\n        }\n      }\n    })\n  }\n\n  await initializeCoreDatabase(_knex)\n  return _knex\n}\n\nmodule.exports = ({ sqlite, postgres }) => {\n\n  let knex = null\n\n  const getDb = async () => {\n    if (!knex) {\n      knex = createKnex({ sqlite, postgres })\n    }\n\n    return await knex\n  }\n\n  const saveUser = ({ id, platform, gender, timezone, locale, picture_url, first_name, last_name }) => {\n    const userId = platform + ':' + id\n    const userRow = {\n      id: userId,\n      userId: id,\n      platform: platform,\n      gender: gender || 'unknown',\n      timezone: timezone || null,\n      locale: locale || null,\n      created_on: moment(new Date()).toISOString(),\n      picture_url: picture_url,\n      last_name: last_name,\n      first_name: first_name\n    }\n\n    return getDb()\n    .then(knex => {\n      var query = knex('users').insert(userRow)\n      .where(function() {\n        return this\n          .select(knex.raw(1))\n          .from('users')\n          .where('id', '=', userId)\n      })\n\n      if (postgres.enabled) {\n        query = `${query} on conflict (id) do nothing`\n      } else { // SQLite\n        query = query.toString().replace(/^insert/i, 'insert or ignore')\n      }\n\n      return knex.raw(query)\n    })\n  }\n\n  let kvs_instance = null\n\n  const createKvs = async () => {\n    const knex = await getDb()\n    let _kvs = new kvs(knex)\n    await _kvs.bootstrap()\n    return _kvs\n  }\n\n  const getKvs = async () => {\n    if (!kvs_instance) {\n      kvs_instance = createKvs()\n    }\n\n    return await kvs_instance\n  }\n\n  const kvsGet = function() {\n    const args = arguments\n    return getKvs()\n    .then(instance => instance.get.apply(null, args))\n  }\n\n  const kvsSet = function() {\n    const args = arguments\n    return getKvs()\n    .then(instance => instance.set.apply(null, args))\n  }\n\n  return {\n    get: getDb,\n    saveUser,\n    location: postgres.enabled ? 'postgres' : sqlite.location,\n    kvs: { get: kvsGet, set: kvsSet }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/index.js","import { table_factories } from '+/database'\n\nmodule.exports = [\n  require('./users.js'),\n  require('./tags.js')\n].concat(table_factories)\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/tables.js","module.exports = {\n  table_factories: []\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/database/index.js","/*\n  A table storing all the interlocutors (users) and their information\n*/\n\nimport helpers from './helpers'\n\nmodule.exports = knex => {\n  return helpers(knex).createTableIfNotExists('users', function (table) {\n    table.string('id').primary()\n    table.string('userId')\n    table.string('platform')\n    table.enu('gender', ['unknown', 'male', 'female'])\n    table.integer('timezone')\n    table.string('picture_url')\n    table.string('first_name')\n    table.string('last_name')\n    table.string('locale')\n    table.timestamp('created_on')\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/users.js","/*\n  A table storing all the user tags\n*/\n\nimport helpers from './helpers'\n\nmodule.exports = knex => {\n  return helpers(knex).createTableIfNotExists('users_tags', function (table) {\n    table.string('userId')\n    table.string('tag')\n    table.string('value')\n    table.timestamp('tagged_on')\n    table.unique(['userId', 'tag'])\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/database/tags.js","import fs from 'fs'\nimport { resolveProjectFile } from './util'\n\nmodule.exports = (projectLocation) => {\n\n  const getBotInformation = () => {\n    const packageJsonPath = resolveProjectFile('package.json', projectLocation, true)\n    const packageJson = JSON.parse(fs.readFileSync(packageJsonPath))\n\n    return {\n      name: packageJson.name,\n      version: packageJson.version,\n      description: packageJson.description || '<no description>',\n      author: packageJson.author || '<no author>',\n      license: packageJson.license || 'AGPL-v3.0'\n    }\n  }\n\n  return { getBotInformation }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/about.js","import path from 'path'\nimport util from 'util'\n\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nimport Engine from './engine'\nimport Proactive from './proactive'\n\nconst fs = Promise.promisifyAll(require('fs'))\n\nmodule.exports = ({ logger, middlewares, botfile, projectLocation, db }) => {\n\n  const processors = {} // A map of all the platforms that can process outgoing messages\n  const templates = {} // A map of all the platforms templates\n  const storagePath = getStoragePath()\n\n  function registerConnector({ platform, processOutgoing, templates }) {\n\n    // TODO throw if templates not array\n    // TODO throw if platform not string\n    // TODO throw if processOutgoing not a function\n    // TODO throw if platform already registered\n\n    logger.verbose(`[UMM] Enabled for ${platform}`) // TODO remove that\n\n    processors[platform] = processOutgoing\n    templates[platform] = templates\n  }\n\n  function parse({ context, outputPlatform, markdown = null, incomingEvent = null }) {\n    // TODO throw if context empty\n\n    // TODO throw if markdown nil <<<==== Pick default markdown\n    // TODO throw if incomingEvents null <<<==== MOCK IT\n\n    const options = {\n      throwIfNoPlatform: true,\n      currentPlatform: outputPlatform\n    }\n\n    return Engine({ markdown, context, options, processors, incomingEvent })\n  }\n\n  function getTemplates() {\n    return _.merge({}, templates) // Return a deep copy\n  }\n\n  function getStoragePath() {\n    const resolve = file => path.resolve(projectLocation, file)\n    let ummPath = _.get(botfile, 'umm.contentPath')\n\n    if (!ummPath) {\n      const single = resolve('content.yml')\n      const folder = resolve('content')\n\n      if (fs.existsSync(single)) {\n        ummPath = single\n      } else if (fs.existsSync(folder)) {\n        ummPath = folder\n      } else {\n        throw new Error('UMM content location not found')\n      }\n    }\n\n    if (path.isAbsolute(ummPath)) {\n      return ummPath\n    } else {\n      return path.resolve(projectLocation, ummPath)\n    }\n  }\n\n  function saveDocument(content) {\n    if (_.isObject(content)) {\n      return Promise.map(Object.keys(content), fileName => {\n        const filePath = path.join(storagePath, fileName + '.yml')\n        return fs.writeFileAsync(filePath, content[fileName], 'utf8')\n      })\n    }\n\n    return fs.writeFileAsync(storagePath, content, 'utf8')\n  }\n\n  async function getDocument() {\n    const stats = await fs.statAsync(storagePath)\n\n    if (stats.isDirectory()) {\n      const files = await fs.readdirAsync(storagePath)\n      const contents = {}\n\n      files.forEach(file => {\n        const filename = path.basename(file, path.extname(file))\n        contents[filename] = fs.readFileAsync(path.join(storagePath, file), 'utf8')\n      })\n\n      return Promise.props(contents)\n    }\n\n    return fs.readFileAsync(storagePath, 'utf8')\n  }\n\n  function doSendBloc(bloc) {\n    return Promise.mapSeries(bloc, message => {\n      if (message.__internal) {\n        if (message.type === 'wait') {\n          return Promise.delay(message.wait)\n        }\n      } else {\n        return middlewares.sendOutgoing(message)\n      }\n    })\n  }\n\n  async function sendBloc(incomingEvent, blocName, additionalData = {}) {\n    blocName = blocName[0] === '#' ? blocName.substr(1) : blocName\n    const split = blocName.split('.')\n    let fileName = null\n\n    if (split.length === 2) {\n      fileName = split[0]\n      blocName = split[1]\n    }\n\n    let markdown = await getDocument()\n\n    // TODO Add more context\n    const fullContext = Object.assign({\n      user: incomingEvent.user,\n      originalEvent: incomingEvent\n    }, additionalData)\n\n    if (_.isObject(markdown)) {\n      if (!fileName) {\n        throw new Error(`Unknown UMM bloc filename: ${blocName}`)\n      }\n\n      if (!markdown[fileName]) {\n        throw new Error(`UMM content ${fileName}.yml not found`)\n      }\n\n      markdown = markdown[fileName]\n    }\n\n    let blocs = parse({\n      context: fullContext,\n      outputPlatform: incomingEvent.platform,\n      markdown: markdown,\n      incomingEvent: incomingEvent\n    })\n\n    // TODO check if message OK and catch errors\n    // TODO throw if bloc does not exist\n\n    const bloc = blocs[blocName]\n\n    return doSendBloc(bloc)\n  }\n\n  function processIncoming(event, next) {\n    event.reply = (blocName, additionalData = {}) => {\n      return sendBloc(event, blocName, additionalData)\n    }\n\n    next()\n  }\n\n  const incomingMiddleware = {\n    name: 'UMM.instrumentation',\n    type: 'incoming',\n    order: 2, // Should really be first\n    module: 'botpress',\n    description: 'Built-in Botpress middleware that adds a `.reply` to events. Works with UMM.',\n    handler: processIncoming\n  }\n\n  const proactiveMethods = Proactive({ sendBloc, db })\n\n  return { registerConnector, parse, getTemplates, incomingMiddleware, getDocument, saveDocument, ...proactiveMethods }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/umm/index.js","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 65\n// module chunks = 0","import Mustache from 'mustache'\nimport yaml from 'js-yaml'\nimport ms from 'ms'\nimport _ from 'lodash'\n\nclass ParsingError extends Error {\n  constructor(bloc, instructionIndex, error) {\n    super(`Error parsing bloc '${bloc}' at instruction ${instructionIndex + 1}: ${error}`)\n    this.bloc = bloc\n    this.instructionIndex = instructionIndex\n    this.internalMessage = error\n    Error.captureStackTrace(this, ParsingError)\n  }\n}\n\nconst mapBlocs = (rawBlocs, options, processors, incomingEvent) => {\n\n  const {\n    currentPlatform,\n    throwIfNoPlatform = false\n  } = options\n\n  if (!currentPlatform && throwIfNoPlatform) {\n    throw new Error('You need to supply `currentplatform`')\n  }\n\n  return _.mapValues(rawBlocs, mapBloc)\n\n  function premapInstruction({ instruction, index, instructions, detectedPlatforms, bloc }) {\n\n    if (typeof instruction === 'string' || _.isArray(instruction)) {\n      return [{\n        text: instruction\n      }]\n    }\n\n    // Parsing conditionals\n    const evaluate = (val, exp) => {\n\n      if (typeof exp === 'boolean') {\n        return val === exp\n      } if (_.isArrayLike(exp)) {\n        return val ? !_.isEmpty(exp) : _.isEmpty(exp)\n      } else {\n        return val ? !!exp : !exp\n      }\n    }\n    \n    if (!_.isNil(instruction.if) && !_.isNil(instruction.unless)) {\n      throw new ParsingError(bloc, index, \"Message can't be both 'if' and 'else'.\")\n    }\n\n    if (!_.isNil(instruction.unless) && !evaluate(false, instruction.unless)) {\n      return []\n    }\n\n    if (!_.isNil(instruction.if) && !evaluate(true, instruction.if)) {\n      return []\n    }\n\n    // Parsing \".on\"\n    let i = Object.assign({}, instruction)\n    if (instruction.on) {\n      if (typeof instruction.on === 'string') {\n        const platforms = instruction.on.toLowerCase().split('+').map(_.trim)\n        if (!_.includes(platforms, currentPlatform.toLowerCase())) {\n          return []\n        } else {\n          i['__platformSpecific'] = true\n        }\n      } else if (_.isPlainObject(instruction.on)) {\n        const on = _.mapKeys(instruction.on, (__, key) => key.toLowerCase())\n\n        // This allows multiple platforms to be specified\n        // e.g. \"messenger+slack+web\"\n        _.keys(on).forEach(key => {\n          if (key.indexOf('+') >= 0) {\n            _.split(key, '+').forEach(alias => {\n              const trimmed = _.trim(alias)\n              on[trimmed] = _.merge({}, on[trimmed] || {}, on[key])\n            })\n          }\n        })\n\n        i = Object.assign(i, on[currentPlatform.toLowerCase()], { on: currentPlatform })\n      } else {\n        throw new ParsingError(bloc, index, '\"on\" must be a string or a plain object but was a ' \n          + typeof(instruction.on))\n      }\n    }\n\n    return [i]\n  }\n\n  function mapInstruction({ instruction, messages, bloc }) {\n    const ret = []\n\n    if (!_.isNil(instruction.wait)) {\n      ret.push({\n        __internal: true,\n        type: 'wait',\n        wait: _.isString(instruction.wait)\n          ? ms(instruction.wait || 1000 )\n          : (parseInt(instruction.wait) || 1000)\n      })\n    }\n\n    if (!_.isNil(instruction.typing)) {\n      instruction.typing = _.isString(instruction.typing)\n          ? ms(instruction.typing || 1000)\n          : (parseInt(instruction.typing) || 1000)\n    }\n\n    const raw = _.omit(instruction, ['unless', 'if', 'on', 'wait'])\n\n    if (!_.keys(raw).length) {\n      return ret\n    }\n\n    if (_.isArray(instruction.text)) {\n      instruction.text = _.sample(instruction.text)\n    }\n\n    const processor = currentPlatform && processors[currentPlatform]\n    if (processor) {\n      const msg = processor({ instruction, messages, blocName: bloc, event: incomingEvent })\n      if (msg) {\n        ret.push(msg)\n      }\n\n      return ret\n    }\n\n    throw new Error('Unsupported platform: ' + currentPlatform)\n  }\n\n  function mapBloc(bloc, name) {\n    // if the bloc isn't an array, error\n\n    const messages = []\n    const detectedPlatforms = []\n    const instructions = []\n\n    // Premapping allows for modifications, drop and addition of instructions\n    _.forEach(bloc, (instruction, index) => {\n      const add = premapInstruction({ \n        instruction, \n        index, \n        instructions: bloc, \n        detectedPlatforms, \n        bloc: name\n      })\n\n      add && _.forEach(add, i => instructions.push(i))\n    })\n\n    _.forEach(instructions, instruction => {\n      const m = mapInstruction({ instruction, messages, bloc: name })\n\n      if (!_.isNil(m)) {\n        // Messages can be null when the instruction only modified existing messages\n        m.forEach(message => messages.push(message))\n      }\n    })\n\n    return messages\n  }\n\n} // mapBlocs\n\nmodule.exports = ({ markdown, context, options, processors, incomingEvent }) => {\n  Mustache.parse(markdown)\n  const mustached = Mustache.render(markdown, context)\n\n  // The reason we support multi-doc is that people might want to separate documents\n  // Both visually and practically when the file gets large\n  const rawBlocs = {}\n  yaml.safeLoadAll(mustached, rawBloc => Object.assign(rawBlocs, rawBloc))\n\n  return mapBlocs(rawBlocs, options, processors, incomingEvent)\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/umm/engine.js","module.exports = require(\"mustache\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mustache\"\n// module id = 67\n// module chunks = 0","module.exports = require(\"ms\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ms\"\n// module id = 68\n// module chunks = 0","import util from 'util'\n\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nmodule.exports = ({ sendBloc, db }) => {\n\n  async function getUser(id) {\n    const knex = await db.get()\n    const users = await knex('users')\n      .where(function() {\n        if (id.indexOf(':') > 0) {\n          this.where({ id: id })\n        } else {\n          this.where('userId', id)\n        }\n      })\n      .limit(1).select('*')\n\n    if (!users || users.length <= 0) {\n      throw new Error(`User \"${id}\" not found in the database`)\n    }\n\n    return users[0]\n  }\n\n  /**\n   * Sends a proactive UMM message to a user\n   * @param  {string|object} user UserId or a full user object\n   * @param  {string} bloc The bloc name to send\n   * @param  {object} data Additional data to provide to the bloc\n   * @return {Promise}      A promise that the bloc is sent\n   */\n  async function sendToUser(user, bloc, data) {\n    if (!_.isString(bloc)) {\n      throw new Error('Invalid bloc id: ' + bloc)  \n    }\n\n    if (_.isString(user)) {\n      user = await getUser(user)\n    }\n\n    if (!user || !user.id) {\n      throw new Error('Invalid user object: ' + util.inspect(user))\n    }\n\n    const text = 'This is not a real event, it has been forged by UMM.'\n    const forgedEvent = {\n      platform: user.platform,\n      user: user,\n      type: 'proactive',\n      text: text,\n      raw: { forged: true, message: text }\n    }\n\n    return sendBloc(forgedEvent, bloc, data)\n  }\n\n  return { sendToUser }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/umm/proactive.js","import _ from 'lodash'\nimport helpers from './database/helpers'\n\nmodule.exports = ({ db }) => {\n  \n  async function tag(userId, tag, value = true) {\n    const knex = await db.get()\n    \n    tag = _.toUpper(tag)\n\n    if (await hasTag(userId, tag)) {\n      await knex('users_tags')\n      .where({ userId, tag })\n      .update({\n        userId,\n        tag,\n        value,\n        tagged_on: helpers(knex).date.now()\n      }).then()\n    } else {\n      await knex('users_tags').insert({\n        userId,\n        tag,\n        value,\n        tagged_on: helpers(knex).date.now()\n      }).then()\n    }\n    \n    return true\n  }\n\n  async function untag(userId, tag) {\n    const knex = await db.get()\n\n    return knex('users_tags')\n    .where({ userId, tag: _.toUpper(tag) })\n    .del().then()\n  }\n\n  async function hasTag(userId, tag) {\n    const knex = await db.get()\n\n    return knex('users_tags')\n    .select('userId')\n    .where({ userId, tag: _.toUpper(tag) })\n    .limit(1)\n    .then(ret => ret.length > 0)\n  }\n\n  async function getTag(userId, tag) {\n    const knex = await db.get()\n\n    return knex('users_tags')\n    .select('value')\n    .where({ userId, tag: _.toUpper(tag) })\n    .limit(1)\n    .then()\n    .get(0)\n    .then(ret => ret && ret.value)\n  }\n\n  async function getTags(userId) {\n    const knex = await db.get()\n\n    return knex('users_tags')\n    .where({ userId })\n    .select('tag', 'value')\n    .then(tags => {\n      return _.map(tags, (v) => {\n        return { tag: v.tag, value: v.value }\n      })\n    })\n  }\n\n  async function getCreationDate(userId) {\n    const knex = await db.get()\n\n    return knex('users')\n    .where({ userId })\n    .select('created_on')\n    .limit(1)\n    .then()\n    .get(0)\n    .then(ret => ret && ret.created_on)\n  }\n\n  async function list(limit = 50, fromId = null) {\n    const knex = await db.get()\n\n    let fromDate = helpers(knex).date.now()\n    \n    if (!_.isNil(fromId)) {\n      fromDate = await getCreationDate(fromId)\n    }\n\n    return knex('users')\n    .select(\n      'userId',\n      'platform',\n      'gender',\n      'timezone',\n      'locale',\n      'picture_url',\n      'first_name',\n      'last_name',\n      'created_on'\n    )\n    .orderBy('created_on', 'desc')\n    .whereNot('userId', fromId)\n    .where('created_on', '<', fromDate)\n    .limit(limit)\n    .then(users => {\n      return Promise.all(_.map(users, async (user) => {\n        const tags = await getTags(user.userId)\n        user.id = user.userId\n        user.tags = tags\n        return user\n      }))\n    })\n  }\n\n\n  async function count() {\n    const knex = await db.get()\n\n    return knex('users')\n    .count('* as count')\n    .get(0)\n    .then(ret => ret)\n  }\n\n\n  return { tag, untag, hasTag, getTag, getTags, list, count }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/users.js","import EventEmmiter from 'eventemitter2'\nimport ms from 'ms'\nimport _ from 'lodash'\nimport Promise from 'bluebird'\n\nimport { matches } from './listeners'\n\nconst INTERVAL_MSGS = 5000\n\nconst formatMessage = (msg, initialEvent) => {\n  if (typeof msg === 'string') {\n    return {\n      platform: initialEvent.platform,\n      user: initialEvent.user,\n      type: 'text',\n      text: msg,\n      raw: {\n        user: initialEvent.user,\n        message: msg\n      }\n    }\n  } else if (typeof msg === 'function') {\n    // This is a 'wrapped' or 'delayed' execution message\n    // It is going to be evaluated at send time, this this has a risk of failing\n    // If the function execution fails\n    return msg\n  } else {\n    if (msg && msg.type && msg.platform && msg.text) {\n      return msg\n    } else {\n      throw new Error('Invalid message: ', msg)\n    }\n  }\n}\n\nconst formatBloc = (blocName, data = {}) => {\n  if (!_.isString(blocName)) {\n    throw new Error('Invalid bloc name, espected string')\n  }\n\n  return {\n    isBloc: true,\n    bloc: blocName,\n    data: data\n  }\n}\n\nconst isBlocCall = args => {\n  return _.isString(args[0]) && args[0].startsWith('#')\n}\n\nconst validateHandlers = handlers => {\n  if (_.isFunction(handlers)) {\n    return [{\n      default: true,\n      callback: handlers\n    }]\n  }\n\n  if (!_.isArray(handlers)) {\n    throw new Error('Invalid handler(s) for question, expected a function or an array of handlers (see doc).')\n  }\n\n  return handlers\n}\n\nclass Thread extends EventEmmiter {\n\n  constructor(name, bp, convo) {\n    super()\n    this.initialEvent = convo.initialEvent\n    this.name = name\n    this.bp = bp\n    this.convo = convo\n    this.queue = [] // Queue of messages and questions to say / ask next\n    this.archive = [] // Archive of unqueued questions. We store them so we can re-create (restart) the thread.\n    this.waiting = false // Thread is waiting when it asked for a question\n    this._last = null\n  }\n\n  enqueue(message) {\n    this.queue.push(message)\n    this.archive.push(message)\n  }\n\n  addMessage(msg) {\n    if (isBlocCall(arguments)) {\n      // Add bloc\n      const blocName = arguments[0]\n      const blocData = arguments[1]\n\n      return this.enqueue({\n        type: 'message',\n        message: formatBloc(blocName, blocData)\n      })\n    }\n\n    // Add raw message\n    const message = formatMessage(msg, this.initialEvent)\n    this.enqueue({\n      type: 'message',\n      message: message\n    })\n  }\n\n  // Two signatures possible:\n  // msg, handlers\n  // bloc, data, handlers\n  addQuestion(msg) {\n    const handlers = validateHandlers(_.last(arguments))\n\n    if (isBlocCall(arguments)) {\n      // Add bloc question\n      const blocName = arguments[0]\n      const blocData = arguments.length >= 3 // Because of handlers and data is optional\n        ? arguments[1]\n        : null\n\n      return this.enqueue({\n        type: 'question',\n        message: formatBloc(blocName, blocData),\n        handlers: handlers\n      })\n    }\n    \n    // Add raw message question\n    const message = formatMessage(msg, this.initialEvent)\n\n    this.enqueue({\n      type: 'question',\n      message: message,\n      handlers: handlers\n    })\n  }\n\n  peek() {\n    return this.queue.length > 0 ? this.queue[0] : null\n  }\n\n  dequeue() {\n    const msg = this.queue.shift()\n\n    this._last = msg\n    this.waiting = msg && msg.type === 'question'\n\n    if (!msg) {\n      this.emit('done')\n    }\n\n    return msg\n  }\n\n  process(event) {\n    const handlers = (this.waiting && this._last && this._last.handlers) || []\n\n    for (let handler of handlers) {\n      if (handler.pattern && matches(handler.pattern, event)) {\n        if (_.isRegExp(handler.pattern)) {\n          const match = handler.pattern.exec(event.text)\n          if (match) {\n            event.match = match[1]\n          }\n        }\n\n        handler.callback && handler.callback(event)\n        return // Interrupt further processing\n      }\n    }\n\n    const defaultHandler = _.find(handlers, { default: true })\n\n    defaultHandler && defaultHandler.callback && defaultHandler.callback(event)\n  }\n\n  repeat() {\n    return this._last && this._last.message\n  }\n\n  restart() {\n    this.queue = this.archive.map(i => i)\n    this._last = null\n    this.waiting = false\n  }\n}\n\nclass Conversation extends EventEmmiter {\n\n  constructor({ initialEvent, middleware, logger, messageTypes, clockSpeed = 500 }) {\n    super()\n    this.logger = logger\n    this.middleware = middleware\n    this.initialEvent = initialEvent\n    this._threads = {}\n    this.currentThread = null\n    this.defaultThread = this.createThread('default')\n    this.status = 'new'\n    this.get = this._get\n    this.set = this._set\n    this._cache = {}\n    this.intervalBetweenMessages = INTERVAL_MSGS\n    this._timeoutHandle = null\n    this._timeoutInterval = ms('5 minutes')\n    this._useTimeout = false\n    this._clock = setInterval(::this.tick, clockSpeed)\n    this._clockSpeed = clockSpeed\n    this._processing = false\n    this._sendLock = false\n    this.messageTypes = messageTypes || ['message', 'text', 'quick_reply']\n    this._outgoing = []\n    this.endWhenDone = true\n\n    this.sendNext() // Infinite loop. Must be called only once.\n  }\n\n  get threads() {\n    return Object.assign({}, this._threads)\n  }\n\n  async sendNext() {\n    if (this._sendLock) {\n      return\n    } else {\n      this._sendLock = true\n    }\n\n    try {\n      const msg = this._outgoing.shift()\n\n      if (msg) {\n\n        if (msg.isBloc === true) {\n          // Send bloc\n          if (!this.initialEvent || !this.initialEvent.reply) {\n            throw new Error(\"Convo doesn't have default event or does not support UMM\")\n          }\n\n          let data = msg.data\n\n          if (_.isFunction(data)) {\n            data = await Promise.resolve(data())\n          }\n\n          await Promise.resolve(this.initialEvent.reply(msg.bloc, data))\n        } else {\n          // Raw message\n          await Promise.resolve(this.middleware\n          && this.middleware.sendOutgoing \n          && this.middleware.sendOutgoing(msg))\n        }\n      }\n\n      await Promise.delay(this._clockSpeed)\n      \n      if (this.status === 'active' || this._outgoing.length > 0) {\n        setImmediate(::this.sendNext)\n      }\n    } finally {\n      this._sendLock = false\n    }\n  }\n\n  teardown() {\n    // Dispose of timeouts and intervals\n    clearInterval(this._clock)\n    this.clearTimeout()\n    this.status = 'destroyed'\n  }\n\n  getCurrentThread() {\n    return this._threads[this.currentThread]\n  }\n\n  tick() {\n    const thread = this.getCurrentThread()\n    if (this.status === 'active' && !thread.waiting && !!thread.peek()) {\n      this.next()\n    }\n  }\n\n  clearTimeout() {\n    if (this._timeoutHandle) {\n      this.clearTimeout(this._timeoutHandle)\n    }\n  }\n\n  resetTimeout() {\n    this.clearTimeout()\n\n    this._timeoutHandle = this._useTimeout && setTimeout(() => {\n      // TODO If there's a timeout thread, switch to it\n      this.emit('timeout')\n    }, this._timeoutInterval)\n  }\n\n  createThread(name) {\n    const thread = new Thread(name, this.bp, this)\n    this._threads[name] = thread\n\n    if (!this.currentThread) {\n      this.currentThread = name\n    }\n\n    return thread\n  }\n\n  async switchTo(name, restart = true) {\n    if (this.currentThread === name) {\n      return // Don't switch if it's already the current thread\n    }\n\n    if (!this._threads[name]) {\n      throw new Error(`Thread \"${name}\" doesn't exist`)\n    }\n\n    const before = await this.emitAsync('beforeSwitch', name)\n    if (_.some(before, a => a === false)) {\n      return // Aborted thread switch\n    }\n\n    this.currentThread = name\n\n    if (restart) {\n      const thread = this.getCurrentThread()\n      thread && thread.restart()\n    }\n\n    this.emit('switched', name)\n  }\n\n  next() {\n    const thread = this.getCurrentThread()\n    const msg = thread.dequeue()\n    if (msg) {\n      let message = msg.message\n\n      if (typeof message === 'function') {\n        // Executes (unwrap) the message on the fly\n        message = msg.message()\n      }\n\n      this.say(message, this.initialEvent)\n    } else {\n      this.endWhenDone && this.stop('done')\n    }\n  }\n\n  async processIncoming(event) {\n\n    if (!_.includes(this.messageTypes, event.type)) {\n      return\n    }\n\n    this._timeoutHandle && this.resetTimeout()\n    const before = await this.emitAsync('beforeProcessing', event)\n    if (_.some(before, a => a === false)) {\n      return\n    }\n\n    const thread = this.getCurrentThread()\n    thread && thread.waiting && thread.process(event)\n  }\n\n  setTimeout(timeout) {\n    this._useTimeout = true\n    this._timeoutInterval = typeof timeout === 'number' ? timeout : ms(timeout)\n    this.resetTimeout()\n  }\n\n  async say(msg) {\n    let message = null\n\n    if (msg && msg.isBloc === true) {\n      message = msg\n    } else {\n      message = isBlocCall(arguments)\n        ? formatBloc(...arguments)\n        : formatMessage(msg)\n    }\n\n    this._outgoing.push(message)\n\n    if (this.status !== 'active') {\n      this.sendNext() // restart sending process once\n    }\n  }\n\n  activate() {\n    if (this.status === 'new') {\n      this.status = 'active'\n      this.emit('activated')\n    } else {\n      throw new Error('Conversation was already activated')\n    }\n  }\n\n  getStatus() {\n    return this.status\n  }\n\n  _get(name) {\n    return this._cache[name]\n  }\n\n  _set(name, value) {\n    this._cache[name] = value\n  }\n\n  async repeat() {\n    const thread = this._threads[this.currentThread]\n    const msg = thread && thread.repeat()\n\n    if (msg) {\n      return this.say(msg)\n    }\n  }\n\n  stop(reason) {\n    this.status = reason\n    this.emit(reason)\n\n    if (reason !== 'stop') {\n      this.emit('stop', reason)\n    }\n    this.teardown()\n  }\n}\n\nmodule.exports = ({ logger, middleware, clockSpeed = 500 }) => {\n  let convos = []\n\n  const belongsToConvo = (convo, event) => {\n    const initial = convo.initialEvent\n\n    return convo.initialEvent.platform === event.platform\n      && _.get(initial, 'user.id', '') === _.get(event, 'user.id', '')\n  }\n\n  middleware.register({\n    name: 'conversations',\n    type: 'incoming',\n    order: 25,\n    module: 'botpress',\n    description: 'Built-in conversation flow manager',\n    handler: function(event, next) {\n\n      // Clean up and free from memory ended conversations\n      convos = _.filter(convos, c => {\n        return _.includes(['new', 'active'], c.status)\n      })\n\n      for (let convo of convos) {\n        if (belongsToConvo(convo, event) && convo.status === 'active') {\n          convo.processIncoming(event)\n          return // Stop the processing, only one convo per event. Swallow the event\n        }\n      }\n\n      next && next() // Don't swallow the event\n    }\n  })\n\n  const validateEvent = event => {\n    if (!event || !event.type || !event.platform) {\n      throw new Error('You need to pass an original incoming event to start a conversation')\n    }\n  }\n\n  function start(event, callback) {\n    const convo = create(event)\n    callback && callback(convo)\n\n    convo.activate()\n    return convo\n  }\n\n  function create(event) {\n    validateEvent(event)\n    const convo = new Conversation({\n      logger,\n      middleware,\n      clockSpeed,\n      initialEvent: event\n    })\n    convos.push(convo)\n    return convo\n  }\n\n  function find(event) {\n    for (let convo of convos) {\n      if (belongsToConvo(convo, event) && convo.status === 'active') {\n        return convo\n      }\n    }\n  }\n\n  function destroy() {\n    for (let convo of convos) {\n      convo.teardown()\n    }\n\n    convos = []\n  }\n\n  return { start, create, find, destroy }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/conversations.js","module.exports = {\n\t\"name\": \"botpress\",\n\t\"description\": \"The world's first CMS for bots. Easily create, manage and extend chatbots.\",\n\t\"version\": \"1.0.14\",\n\t\"author\": \"Botpress\",\n\t\"bin\": {\n\t\t\"bp\": \"./bin/botpress\",\n\t\t\"botpress\": \"./bin/botpress\"\n\t},\n\t\"bugs\": {\n\t\t\"url\": \"https://github.com/botpress/botpress/issues\"\n\t},\n\t\"dependencies\": {\n\t\t\"axios\": \"^0.15.2\",\n\t\t\"babel-polyfill\": \"^6.23.0\",\n\t\t\"bluebird\": \"^3.4.6\",\n\t\t\"body-parser\": \"^1.15.2\",\n\t\t\"chalk\": \"^1.1.3\",\n\t\t\"commander\": \"^2.9.0\",\n\t\t\"dotenv\": \"^4.0.0\",\n\t\t\"email-templates\": \"^2.5.4\",\n\t\t\"eventemitter2\": \"^2.1.3\",\n\t\t\"express\": \"^4.14.0\",\n\t\t\"formidable\": \"^1.1.1\",\n\t\t\"handlebars\": \"^4.0.6\",\n\t\t\"howler\": \"^2.0.3\",\n\t\t\"js-yaml\": \"^3.8.4\",\n\t\t\"jsonwebtoken\": \"^7.1.9\",\n\t\t\"knex\": \"^0.12.6\",\n\t\t\"lodash\": \"^4.16.4\",\n\t\t\"moment\": \"^2.15.1\",\n\t\t\"ms\": \"^0.7.1\",\n\t\t\"mustache\": \"^2.3.0\",\n\t\t\"mware\": \"0.0.3\",\n\t\t\"node-machine-id\": \"^1.1.3\",\n\t\t\"nodemailer\": \"^2.7.2\",\n\t\t\"pg\": \"^6.1.2\",\n\t\t\"prompt\": \"^1.0.0\",\n\t\t\"react-codemirror\": \"^1.0.0\",\n\t\t\"socket.io\": \"^1.5.0\",\n\t\t\"socket.io-client\": \"^2.0.3\",\n\t\t\"socketio-jwt\": \"^4.5.0\",\n\t\t\"source-map-support\": \"^0.4.6\",\n\t\t\"sqlite3\": \"^3.1.8\",\n\t\t\"universal-analytics\": \"^0.4.8\",\n\t\t\"uuid\": \"^3.0.0\",\n\t\t\"winston\": \"^2.2.0\"\n\t},\n\t\"devDependencies\": {\n\t\t\"autoprefixer\": \"^6.5.3\",\n\t\t\"babel-cli\": \"^6.16.0\",\n\t\t\"babel-core\": \"^6.18.0\",\n\t\t\"babel-eslint\": \"^7.1.0\",\n\t\t\"babel-loader\": \"^6.2.5\",\n\t\t\"babel-plugin-root-import\": \"^5.1.0\",\n\t\t\"babel-plugin-transform-decorators-legacy\": \"^1.3.4\",\n\t\t\"babel-plugin-transform-object-rest-spread\": \"^6.16.0\",\n\t\t\"babel-preset-latest\": \"^6.16.0\",\n\t\t\"babel-preset-react\": \"^6.11.1\",\n\t\t\"babel-preset-stage-0\": \"^6.16.0\",\n\t\t\"babel-register\": \"^6.16.3\",\n\t\t\"bootstrap\": \"^3.3.7\",\n\t\t\"chai\": \"^3.5.0\",\n\t\t\"classnames\": \"^2.2.5\",\n\t\t\"copy-webpack-plugin\": \"^4.0.0\",\n\t\t\"css-loader\": \"^0.25.0\",\n\t\t\"eslint\": \"^3.9.0\",\n\t\t\"exports-loader\": \"^0.6.3\",\n\t\t\"expose-loader\": \"^0.7.1\",\n\t\t\"extract-text-webpack-plugin\": \"^1.0.1\",\n\t\t\"file-loader\": \"^0.9.0\",\n\t\t\"hard-source-webpack-plugin\": \"^0.3.7\",\n\t\t\"history\": \"^2.1.2\",\n\t\t\"json-loader\": \"^0.5.4\",\n\t\t\"keymirror\": \"^0.1.1\",\n\t\t\"mocha\": \"^3.1.2\",\n\t\t\"node-sass\": \"^3.13.1\",\n\t\t\"npm-watch\": \"^0.1.6\",\n\t\t\"nuclear-js\": \"^1.4.0\",\n\t\t\"nuclear-js-react-addons\": \"^0.4.1\",\n\t\t\"postcss-loader\": \"^1.1.1\",\n\t\t\"prop-types\": \"^15.5.8\",\n\t\t\"react\": \"^15.3.1\",\n\t\t\"react-addons-css-transition-group\": \"^15.3.1\",\n\t\t\"react-addons-update\": \"^15.4.2\",\n\t\t\"react-bootstrap\": \"^0.30.3\",\n\t\t\"react-bootstrap-button-loader\": \"^1.0.7\",\n\t\t\"react-dom\": \"^15.3.1\",\n\t\t\"react-emoji\": \"^0.4.4\",\n\t\t\"react-fontawesome\": \"^1.2.0\",\n\t\t\"react-ga\": \"^2.1.2\",\n\t\t\"react-markdown\": \"^2.4.5\",\n\t\t\"react-router\": \"^2.8.1\",\n\t\t\"react-sidebar\": \"^2.2.1\",\n\t\t\"react-sortable\": \"^1.2.0\",\n\t\t\"sass-loader\": \"^4.0.2\",\n\t\t\"script-loader\": \"^0.7.0\",\n\t\t\"simple-line-icons\": \"^2.4.1\",\n\t\t\"sinon\": \"^1.17.7\",\n\t\t\"style-loader\": \"^0.13.1\",\n\t\t\"tmp\": \"0.0.31\",\n\t\t\"uglifyjs-webpack-plugin\": \"^0.4.3\",\n\t\t\"webpack\": \"^1.13.2\",\n\t\t\"webpack-node-externals\": \"^1.5.4\"\n\t},\n\t\"engines\": {\n\t\t\"node\": \">=4.6.0\"\n\t},\n\t\"homepage\": \"https://github.com/botpress/botpress#readme\",\n\t\"keywords\": [\n\t\t\"bots\",\n\t\t\"chatbots\",\n\t\t\"bot framework\",\n\t\t\"messenger\",\n\t\t\"facebook\",\n\t\t\"slack\",\n\t\t\"botkit\",\n\t\t\"microsoft bot framework\",\n\t\t\"bot builder\",\n\t\t\"bot\",\n\t\t\"chatbot\",\n\t\t\"api\"\n\t],\n\t\"license\": \"AGPL-3.0\",\n\t\"main\": \"lib/node.bundle.js\",\n\t\"repository\": \"git+https://github.com/botpress/botpress.git\",\n\t\"os\": [\n\t\t\"darwin\",\n\t\t\"linux\",\n\t\t\"win32\"\n\t],\n\t\"scripts\": {\n\t\t\"compile\": \"./build.sh\",\n\t\t\"test\": \"BABEL_ENV=tests mocha --compilers js:babel-core/register --require tests/index.js tests/** extensions/**/tests/**\",\n\t\t\"watch\": \"npm-watch\",\n\t\t\"lint\": \"eslint {src,extensions}/**/*.js*\"\n\t},\n\t\"watch\": {\n\t\t\"compile\": {\n\t\t\t\"patterns\": [\n\t\t\t\t\"src\",\n\t\t\t\t\"extensions\"\n\t\t\t],\n\t\t\t\"extensions\": \"js,jsx,scss,json,html\"\n\t\t}\n\t}\n};\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./package.json\n// module id = 72\n// module chunks = 0","module.exports = () => {}\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/emails/index.js","module.exports = bp => ({\n  install: () => {},\n  uninstall: () => {}\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/mediator/index.js","import express from 'express'\nimport http from 'http'\n\nimport Socket from './socket'\nimport Static from './static'\nimport Api from './api'\n\nmodule.exports = bp => {\n\n  async function serveApi(app) {\n    const api = Api(bp)\n    return api.install(app)\n  }\n\n  async function serveSocket(server) {\n    const socket = Socket(bp)\n    return socket.install(server)\n  }\n\n  async function serveStatic(app) {\n    const staticStuff = Static(bp)\n    return staticStuff.install(app)\n  }\n\n  async function start() {\n    const app = express()\n    const server = http.createServer(app)\n    const port = bp.botfile.port\n\n    await serveApi(app)\n    await serveSocket(server)\n    await serveStatic(app)\n\n    return new Promise(resolve => {\n      server.listen(port, () => resolve())\n    })\n  }\n\n  return { start }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/index.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 76\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 77\n// module chunks = 0","import _ from 'lodash'\nimport socketio from 'socket.io'\nimport socketioJwt from 'socketio-jwt'\n\nmodule.exports = bp => {\n\n  async function install(server) {\n    const io = socketio(server)\n\n    const admin = io.of('/admin')\n    const guest = io.of('/guest')\n\n    if (bp.botfile.login.enabled) {\n      admin.use(socketioJwt.authorize({\n        secret: await bp.security.getSecret(),\n        handshake: true\n      }))\n    }\n\n    admin.on('connection', function(socket) {\n      const visitorId = _.get(socket, 'handshake.query.visitorId')\n      bp.stats.track('socket', 'connected')\n\n      socket.on('event', function(event) {\n        bp.events.emit(event.name, event.data, 'client', {\n          visitorId: visitorId,\n          socketId: socket.id,\n          guest: false,\n          admin: true\n        })\n      })\n    })\n\n    guest.on('connection', function(socket) {\n      const visitorId = _.get(socket, 'handshake.query.visitorId')\n      bp.stats.track('socket', 'connected')\n\n      if (visitorId && visitorId.length > 0) {\n        socket.join('visitor:' + visitorId)\n      }\n\n      socket.on('event', function(event) {\n        bp.events.emit(event.name, event.data, 'client', {\n          socketId: socket.id,\n          visitorId: visitorId,\n          guest: true,\n          admin: false\n        })\n      })\n    })\n\n    bp.events.onAny(function(event, data, from) {\n      if (from === 'client') {\n        return // we sent this ourselves\n      }\n\n      let c = event.startsWith('guest.') ? guest : admin\n\n      if (data && (data.__socketId || data.__room)) {\n        // Send only to this socketId or room\n        return c.to(data.__socketId || data.__room).emit('event', {\n          name: event,\n          data: data\n        })\n      }\n\n      // broadcast event to the front-end clients\n      c.emit('event', {\n        name: event,\n        data: data\n      })\n    })\n  }\n\n  return { install }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/socket.js","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 79\n// module chunks = 0","module.exports = require(\"socketio-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socketio-jwt\"\n// module id = 80\n// module chunks = 0","/* global BP_EDITION */\n\nimport Promise from 'bluebird'\nimport express from 'express'\nimport path from 'path'\nimport fs from 'fs'\nimport ms from 'ms'\nimport util from '../util'\n\nmodule.exports = bp => {\n\n  function serveModule(app, module) {\n    const name = module.name\n    const shortName = module.name.replace(/botpress-/i, '')\n\n    if (module.settings.menuIcon === 'custom') {\n      const iconRequestPath = `/img/modules/${name}.png`\n      const iconPath = path.join(module.root, 'icon.png')\n\n      app.get(iconRequestPath, (req, res) => {\n        try {\n          const content = fs.readFileSync(iconPath)\n          res.contentType('image/png')\n          res.send(content)\n        } catch (err) {\n          bp.logger.warn(`Could not serve module icon [${name}] at: ${iconPath}`)\n        }\n      })\n    }\n\n    const liteDir = path.join(module.root, module.settings.liteDir || 'bin/lite')\n    const liteViews = fs.existsSync(liteDir)\n      ? fs.readdirSync(liteDir).filter(b => b.endsWith('.js'))\n      : []\n\n    app.get([\n      `/js/modules/${shortName}`, // The full module view\n      `/js/modules/${name}.js`, // <<-- DEPRECATED: Will be removed shortly. Only use shortNames\n      `/js/modules/${shortName}/:subview` // Lite view\n    ], (req, res) => {\n      const settingsKey = module.settings.webBundle\n      let bundlePath = path.join(module.root, settingsKey || 'bin/web.bundle.js')\n\n      if (req.params && req.params.subview) {\n        // Render lite view\n        bundlePath = path.join(liteDir, req.params.subview + '.bundle.js')\n      }\n\n      try {\n        const content = fs.readFileSync(bundlePath)\n        res.contentType('text/javascript')\n        res.send(content)\n      } catch (err) {\n        bp.logger.warn(`Could not serve module [${name}] at: ${bundlePath}`)\n        res.sendStatus(404)\n      }\n    })\n  }\n\n  function serveCustomTheme(app) {\n    let customTheme = ''\n\n    if (BP_EDITION !== 'lite' && bp.licensing.getFeatures().whitelabel === true) {\n      const themeLocation = path.join(bp.projectLocation, 'theme.css')\n      if (fs.existsSync(themeLocation)) {\n        customTheme = fs.readFileSync(themeLocation)\n      }\n    }\n\n    app.use('/style/custom-theme.css', (req, res) => {\n      res.contentType('text/css')\n      res.send(customTheme)\n    })\n  }\n\n  async function install(app) {\n\n    for (let name in bp._loadedModules) {\n      const module = bp._loadedModules[name]\n      serveModule(app, module)\n    }\n\n    app.use('/js/env.js', (req, res) => {\n      const { tokenExpiry, enabled } = bp.botfile.login\n      const optOutStats = !!bp.botfile.optOutStats\n      const appName = bp.botfile.appName || 'Botpress'\n      \n      const { isFirstRun, version } = bp\n      res.contentType('text/javascript')\n      res.send(`(function(window) {\n        window.NODE_ENV = \"${process.env.NODE_ENV || 'development'}\";\n        window.DEV_MODE = ${util.isDeveloping};\n        window.AUTH_ENABLED = ${enabled};\n        window.AUTH_TOKEN_DURATION = ${ms(tokenExpiry)};\n        window.OPT_OUT_STATS = ${optOutStats};\n        window.SHOW_GUIDED_TOUR = ${isFirstRun};\n        window.BOTPRESS_VERSION = \"${version}\";\n        window.APP_NAME = \"${appName}\";\n      })(window || {})`)\n    })\n\n    serveCustomTheme(app)\n\n    app.use(express.static(path.join(bp.projectLocation, 'static')))\n    \n    app.use(express.static(path.join(__dirname, '../lib/web')))\n\n    app.get('*', (req, res, next) => {\n      if (/html/i.test(req.headers.accept)) {\n        if (req.url && /^\\/lite\\//i.test(req.url)) {\n          return res.sendFile(path.join(__dirname, '../lib/web/lite.html'))\n        }\n        \n        return res.sendFile(path.join(__dirname, '../lib/web/index.html'))\n      }\n      next()\n    })\n\n    return Promise.resolve(true)\n  }\n\n  return { install }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/static.js","import _ from 'lodash'\nimport bodyParser from 'body-parser'\nimport express from 'express'\n\nimport ServiceLocator from '+/ServiceLocator'\nimport anonymousApis from './anonymous'\nimport securedApis from './secured'\n\nconst routersConditions = {}\nconst routers = {}\n\nmodule.exports = bp => {\n\n  async function _authenticationMiddleware(req, res, next) {\n    res.maybeSendRequireLogin = () => {\n      if (!bp.botfile.login.enabled) {\n        res.status(400).send({\n          message: 'Login must be turned on for this API method'\n        })\n        \n        return true\n      } else {\n        return false\n      }\n    }\n\n    if (!bp.botfile.login.enabled) {\n      return next()\n    }\n\n    const user = await bp.security.authenticate(req.headers.authorization)\n    if (!!user) {\n      req.user = user\n      next()\n    } else {\n      res.status(401).location('/login').end()\n    }\n  }\n\n  function installRouter(app) {\n    bp.getRouter = function(name, conditions) {\n      if (!/^botpress-/.test(name)) {\n        throw new Error(`The name of a router must start with 'botpress-'. Received: ${name}`)\n      }\n\n      if (!routers[name]) {\n        const router = express.Router()\n        routers[name] = router\n        app.use(`/api/${name}/`, router)\n      }\n\n      if (conditions) {\n        routersConditions[name] = Object.assign(routersConditions[name] || {}, conditions)\n      }\n\n      installProtector(routers[name])\n      return routers[name]\n    }\n  }\n\n  function installProtector(app) {\n    app.secure = function(operation, ressource) {\n\n      const wrap = method => function(name, handler) {\n        return app[method].call(app, name, async function(req, res, next) {\n          try {\n            if (!req.user) {\n              return handler(req, res, next)\n            }\n\n            const authorizeApi = await ServiceLocator.getService('authorizeApi', false)\n\n            if (!authorizeApi) {\n              return handler(req, res, next)\n            }\n\n            const authorized = await authorizeApi({ userId: req.user.id, operation, ressource })\n\n            if (authorized) {\n              return handler(req, res, next)\n            }\n\n            return res.sendStatus(403) // HTTP Forbidden\n          } catch (err) {\n            return res.status(500).send({ message: err.message })\n          }\n        })\n      }\n\n      return { \n        get: wrap('get'),\n        post: wrap('post'),\n        put: wrap('put'),\n        delete: wrap('delete')\n      }\n    }\n  }\n\n  function installMaybeUse(app) {\n    app.maybeUse = function() {\n      if (arguments.length === 3) {\n        app.use(arguments[0], maybeApply(arguments[1], arguments[2]))\n      } else if (arguments.length === 2) {\n        app.use(maybeApply(arguments[0], arguments[1]))\n      }\n    }\n  }\n\n  async function install(app) {\n    installRouter(app)\n    installProtector(app)\n    installMaybeUse(app)\n\n    app.maybeUse('bodyParser.json', bodyParser.json())\n    app.maybeUse('bodyParser.urlencoded', bodyParser.urlencoded({ extended: true }))\n\n    anonymousApis(bp, app)\n\n    app.use('/api/*', maybeApply('auth', _authenticationMiddleware))\n\n    securedApis(bp, app)\n  }\n\n  return { install }\n}\n\nfunction maybeApply(name, fn) {\n  return (req, res, next) => {\n    const router = req.originalUrl.match(/\\/api\\/(botpress-[^\\/]+).*$/i)\n    if (!router) {\n      return fn(req, res, next)\n    }\n\n    if (!routersConditions[router[1]]) {\n      return fn(req, res, next)\n    }\n\n    const condition = routersConditions[router[1]][name]\n    if (condition === false) {\n      next()\n    } else if (typeof(condition) === 'function' && condition(req) === false) {\n      next()\n    } else {\n      return fn(req, res, next)\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/api.js","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 83\n// module chunks = 0","import ExtraApiProviders from '+/api'\n\nmodule.exports = (bp, app) => {\n\n  app.post('/api/login', async (req, res) => {\n    bp.stats.track('api', 'auth', 'login')\n    const result = await bp.security.login(req.body.user, req.body.password, req.ip)\n    res.send(result)\n  })\n\n  const apis = ExtraApiProviders(bp, app)\n  apis.anonymous.map(x => x && x()) // Install all anonymous APIs\n  \n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/anonymous.js","import accounts from '+/api/accounts'\n\nmodule.exports = (bp, app) => ({\n  anonymous: [accounts(bp, app).installAnonymous],\n  secured: [accounts(bp, app).installSecured]\n})\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/api/index.js","module.exports = (bp, app) => {\n\n  const installSecured = () => {\n    \n    app.get('/api/my-account', async (req, res) => {\n      res.send(req.user)\n    })\n\n  }\n\n  const installAnonymous = () => {}\n\n  return {\n    name: '[Lite] Accounts Management',\n    installSecured,\n    installAnonymous\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./extensions/lite/api/accounts.js","import _ from 'lodash'\nimport fs from 'fs'\nimport path from 'path'\nimport uuid from 'uuid'\n\nimport util from '../util'\nimport ExtraApiProviders from '+/api'\n\nlet logsSecret = uuid.v4()\n\nmodule.exports = (bp, app) => {\n\n  app.get('/api/ping', (req, res) => {\n    res.send('pong')\n  })\n\n  app.secure('read', 'modules/list')\n  .get('/api/modules', (req, res) => {\n    const modules = _.map(bp._loadedModules, (module) => {\n      return {\n        name: module.name,\n        homepage: module.homepage,\n        menuText: module.settings.menuText || module.name,\n        menuIcon: module.settings.menuIcon || 'view_module',\n        noInterface: !!module.settings.noInterface,\n        plugins: module.settings.plugins || []\n      }\n    })\n    res.send(modules)\n  })\n\n  app.secure('read', 'middleware/list')\n  .get('/api/middlewares', (req, res) => {\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('write', 'middleware/customizations')\n  .post('/api/middlewares/customizations', (req, res) => {\n    bp.stats.track('api', 'middlewares', 'customizations')\n    const { middlewares } = req.body\n    bp.middlewares.setCustomizations(middlewares)\n    bp.middlewares.load()\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('write', 'middleware/customizations')\n  .delete('/api/middlewares/customizations', (req, res) => {\n    bp.stats.track('api', 'middlewares', 'customizations')\n    bp.middlewares.resetCustomizations()\n    bp.middlewares.load()\n    res.send(bp.middlewares.list())\n  })\n\n  app.secure('read', 'notifications')\n  .get('/api/notifications', (req, res) => {\n    res.send(bp.notifications.load())\n  })\n\n  app.secure('read', 'bot/information')\n  .get('/api/bot/information', (req, res) => {\n    res.send(bp.about.getBotInformation())\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/module/all', (req, res) => {\n    bp.modules.listAllCommunityModules()\n    .then(modules => res.send(modules))\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/module/hero', (req, res) => {\n    bp.modules.getRandomCommunityHero()\n    .then(hero => res.send(hero))\n  })\n\n  app.get('/api/bot/production', (req, res) => {\n    res.send(!util.isDeveloping)\n  })\n\n  app.secure('read', 'modules/list/community')\n  .get('/api/bot/contributor', (req, res) => {\n    res.send(bp.bot.getContributor())\n  })\n\n  app.get('/api/license', async (req, res) => {\n    res.send(await bp.licensing.getLicensing())\n  })\n\n  app.secure('write', 'bot/information/license')\n  .post('/api/license', (req, res) => {\n    bp.stats.track('api', 'license', 'change')\n    bp.licensing.changeLicense(req.body.license)\n    .then(() => {\n      res.sendStatus(200)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.secure('write', 'modules/list/install')\n  .post('/api/module/install/:name', (req, res) => {\n    bp.stats.track('api', 'modules', 'install')\n    const { name } = req.params\n    bp.modules.install(name)\n    .then(() => {\n      res.sendStatus(200)\n      bp.restart(1000)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.secure('write', 'modules/list/uninstall')\n  .delete('/api/module/uninstall/:name', (req, res) => {\n    bp.stats.track('api', 'modules', 'uninstall')\n    const { name } = req.params\n    bp.modules.uninstall(name)\n    .then(() => {\n      res.sendStatus(200)\n      bp.restart(1000)\n    })\n    .catch(err => res.status(500).send({\n      message: err && err.message\n    }))\n  })\n\n  app.delete('/api/guided-tour', (req, res) => {\n    fs.unlink(path.join(bp.projectLocation, '.welcome'), () => {\n      bp.isFirstRun = false\n      res.sendStatus(200)\n    })\n  })\n\n  app.secure('read', 'bot/logs')\n  .get('/api/logs', (req, res) => {\n    const options = {\n      from: new Date() - 7 * 24 * 60 * 60 * 1000,\n      until: new Date(),\n      limit: (req.query && req.query.limit) || 50,\n      start: 0,\n      order: 'desc',\n      fields: ['message', 'level', 'timestamp']\n    }\n\n    bp.logger.query(options, (err, results) => {\n      if (err) { return console.log(err) }\n      res.send(results.file)\n    })\n  })\n\n  app.secure('read', 'bot/logs')\n  .get('/api/logs/key', (req, res) => {\n    res.send({ secret: logsSecret })\n  })\n\n  app.secure('read', 'bot/logs/archive')\n  .get('/logs/archive/:key', (req, res) => {\n    bp.stats.track('api', 'logs', 'archive')\n    if (req.params.key !== logsSecret) {\n      return res.sendStatus(403)\n    }\n\n    bp.logger.archiveToFile()\n    .then((archivePath) => {\n      logsSecret = uuid.v4()\n      res.download(archivePath)\n    })\n  })\n\n  app.secure('read', 'bot/umm/blocs')\n  .get('/umm/blocs', (req, res) => {\n    const content = bp.umm.getDocument()\n    res.send({ content: content })\n  })\n\n  app.secure('read', 'bot/umm/templates')\n  .get('/umm/templates', (req, res) => {\n    res.send({ templates: bp.umm.getTemplates() })\n  })\n\n  app.secure('write', 'bot/umm/blocs')\n  .post('/umm/blocs', (req, res) => {\n    const { content } = (req.body || {})\n    if (_.isNil(content)) {\n      return res.status(400).send({ message: 'You need to specify the content' })\n    }\n\n    bp.umm.saveDocument(content)\n\n    return res.sendStatus(200)\n  })\n\n  app.secure('write', 'bot/umm/simulation')\n  .post('/umm/simulate', (req, res) => {\n    try {\n      const { context, content, outputPlatform, incomingEvent } = req.body\n      const blocs = bp.umm.parse({ context, outputPlatform, markdown: content, incomingEvent })\n      res.send(blocs)\n    } catch (err) {\n      res.status(400).send({ message: err.message })\n    }\n  })\n\n  const apis = ExtraApiProviders(bp, app)\n  apis.secured.map(x => x && x()) // Install all secured APIs\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/secured.js"],"sourceRoot":""}